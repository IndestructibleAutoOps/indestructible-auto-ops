{'role': 'assistant', 'content': '繼續實作 Execution-Harness，創建 **Baseline Comparator**：\n\n<function_calls>\n<create-file file_path="gl-runtime-platform/ultra-strict-verification-core/execution-harness/baseline-comparator/baseline-comparator.ts">\n# @GL-governed\n# @GL-layer: GL90-99\n# @GL-semantic: execution-harness-baseline-comparator\n# @GL-charter-version: 2.0.0\n\n/**\n * Execution-Grounded Reality Harness: Baseline Comparator\n * \n * Core Philosophy: "所有報告 → 必須對照 baseline"\n * (All reports must be compared against baseline)\n * \n * Purpose: Compare current behavior against established baselines\n * \n * This module enforces:\n * - All metrics must be compared against baseline\n * - All behaviors must be compared against baseline\n * - All outputs must be compared against baseline\n * - All performance must be compared against baseline\n * - Any deviation must be justified\n */\n\nimport { \n  BaselineComparisonResult,\n  VerificationSeverity,\n  VerificationFinding \n} from \'../../types\';\n\nexport class BaselineComparator {\n  private findings: VerificationFinding[] = [];\n  private baselines: Map<string, any> = new Map();\n\n  /**\n   * Compare metrics against baseline\n   */\n  async compareBaseline(component: string, metrics: any): Promise<BaselineComparisonResult> {\n    this.findings = [];\n    \n    // Load baseline for component\n    const baseline = await this.loadBaseline(component);\n    \n    if (!baseline) {\n      // No baseline exists - this is a finding\n      this.findings.push({\n        id: this.generateId(),\n        type: \'INCONSISTENCY\',\n        severity: VerificationSeverity.MEDIUM,\n        component,\n        location: {\n          module: component\n        },\n        title: \'No Baseline Found\',\n        description: `No baseline exists for component \'${component}\' - cannot compare metrics`,\n        evidence: [{\n          type: \'baseline\',\n          source: component,\n          content: { metrics, baseline: null },\n          timestamp: new Date(),\n          verified: false\n        }],\n        timestamp: new Date(),\n        verified: false,\n        falsifiable: true\n      });\n      \n      return {\n        baselineMatched: false,\n        differences: [{\n          metric: \'baseline\',\n          baseline: null,\n          current: metrics,\n          delta: \'No baseline to compare\',\n          severity: VerificationSeverity.MEDIUM\n        }]\n      };\n    }\n    \n    // Compare metrics against baseline\n    await this.compareMetrics(component, baseline, metrics);\n    \n    return {\n      baselineMatched: this.findings.length === 0,\n      differences: this.extractDifferences()\n    };\n  }\n\n  /**\n   * Load baseline for component\n   */\n  private async loadBaseline(component: string): Promise<any | null> {\n    // Check if baseline is already loaded\n    if (this.baselines.has(component)) {\n      return this.baselines.get(component);\n    }\n    \n    // Try to load from file\n    const baselinePath = this.getBaselinePath(component);\n    \n    try {\n      const fs = require(\'fs\').promises;\n      const content = await fs.readFile(baselinePath, \'utf-8\');\n      const baseline = JSON.parse(content);\n      \n      this.baselines.set(component, baseline);\n      return baseline;\n    } catch (error) {\n      return null;\n    }\n  }\n\n  /**\n   * Compare metrics against baseline\n   */\n  private async compareMetrics(component: string, baseline: any, metrics: any): Promise<void> {\n    // Compare each metric\n    for (const [key, baselineValue] of Object.entries(baseline)) {\n      const currentValue = metrics[key];\n      \n      if (currentValue === undefined) {\n        // Metric missing in current\n        this.findings.push({\n          id: this.generateId(),\n          type: \'INCONSISTENCY\',\n          severity: VerificationSeverity.MEDIUM,\n          component,\n          location: {\n            module: component\n          },\n          title: \'Metric Missing\',\n          description: `Metric \'${key}\' exists in baseline but missing in current`,\n          evidence: [{\n            type: \'baseline\',\n            source: component,\n            content: { key, baseline: baselineValue, current: undefined },\n            timestamp: new Date(),\n            verified: false\n          }],\n          timestamp: new Date(),\n          verified: false,\n          falsifiable: true\n        });\n        \n        continue;\n      }\n      \n      // Compare values\n      const difference = this.calculateDifference(baselineValue, currentValue);\n      \n      if (difference !== null && this.isSignificantDifference(baselineValue, currentValue, difference)) {\n        this.findings.push({\n          id: this.generateId(),\n          type: \'PERFORMANCE_DEGRADATION\',\n          severity: this.getDifferenceSeverity(baselineValue, currentValue, difference),\n          component,\n          location: {\n            module: component\n          },\n          title: \'Baseline Difference Detected\',\n          description: `Metric \'${key}\' differs from baseline: ${baselineValue} → ${currentValue} (delta: ${difference})`,\n          evidence: [{\n            type: \'baseline\',\n            source: component,\n            content: { key, baseline: baselineValue, current: currentValue, delta: difference },\n            timestamp: new Date(),\n            verified: false\n          }],\n          timestamp: new Date(),\n          verified: false,\n          falsifiable: true\n        });\n      }\n    }\n    \n    // Check for new metrics\n    for (const [key, currentValue] of Object.entries(metrics)) {\n      if (!(key in baseline)) {\n        this.findings.push({\n          id: this.generateId(),\n          type: \'INCONSISTENCY\',\n          severity: VerificationSeverity.LOW,\n          component,\n          location: {\n            module: component\n          },\n          title: \'New Metric Detected\',\n          description: `Metric \'${key}\' exists in current but missing from baseline`,\n          evidence: [{\n            type: \'baseline\',\n            source: component,\n            content: { key, baseline: undefined, current: currentValue },\n            timestamp: new Date(),\n            verified: false\n          }],\n          timestamp: new Date(),\n          verified: false,\n          falsifiable: true\n        });\n      }\n    }\n  }\n\n  /**\n   * Calculate difference between baseline and current values\n   */\n  private calculateDifference(baseline: any, current: any): string | null {\n    if (typeof baseline === \'number\' && typeof current === \'number\') {\n      if (baseline === 0) {\n        return current === 0 ? \'0\' : `${current}`;\n      }\n      const percentDiff = ((current - baseline) / Math.abs(baseline)) * 100;\n      return `${current - baseline} (${percentDiff.toFixed(2)}%)`;\n    }\n    \n    if (baseline === current) {\n      return null;\n    }\n    \n    return `${JSON.stringify(current)} (baseline: ${JSON.stringify(baseline)})`;\n  }\n\n  /**\n   * Check if difference is significant\n   */\n  private isSignificantDifference(baseline: any, current: any, difference: string): boolean {\n    if (typeof baseline === \'number\' && typeof current === \'number\') {\n      // More than 5% difference is significant\n      if (baseline === 0) {\n        return current !== 0;\n      }\n      const percentDiff = Math.abs((current - baseline) / baseline) * 100;\n      return percentDiff > 5;\n    }\n    \n    return baseline !== current;\n  }\n\n  /**\n   * Get severity based on difference\n   */\n  private getDifferenceSeverity(baseline: any, current: any, difference: string): VerificationSeverity {\n    if (typeof baseline === \'number\' && typeof current === \'number\') {\n      if (baseline === 0) {\n        return current === 0 ? VerificationSeverity.LOW : VerificationSeverity.HIGH;\n      }\n      \n      const percentDiff = Math.abs((current - baseline) / baseline) * 100;\n      \n      if (percentDiff > 50) {\n        return VerificationSeverity.CRITICAL;\n      } else if (percentDiff > 20) {\n        return VerificationSeverity.HIGH;\n      } else if (percentDiff > 10) {\n        return VerificationSeverity.MEDIUM;\n      }\n      return VerificationSeverity.LOW;\n    }\n    \n    return VerificationSeverity.MEDIUM;\n  }\n\n  /**\n   * Extract differences from findings\n   */\n  private extractDifferences() {\n    return this.findings.map(finding => ({\n      metric: finding.title,\n      baseline: finding.evidence[0]?.content?.baseline,\n      current: finding.evidence[0]?.content?.current,\n      delta: finding.evidence[0]?.content?.delta,\n      severity: finding.severity\n    }));\n  }\n\n  /**\n   * Set baseline for component\n   */\n  setBaseline(component: string, baseline: any): void {\n    this.baselines.set(component, baseline);\n  }\n\n  /**\n   * Save baseline to file\n   */\n  async saveBaseline(component: string, baseline: any): Promise<void> {\n    const baselinePath = this.getBaselinePath(component);\n    const fs = require(\'fs\').promises;\n    \n    await fs.writeFile(baselinePath, JSON.stringify(baseline, null, 2), \'utf-8\');\n    this.baselines.set(component, baseline);\n  }\n\n  /**\n   * Get baseline path for component\n   */\n  private getBaselinePath(component: string): string {\n    return `/workspace/gl-runtime-platform/.baselines/${component}.json`;\n  }\n\n  /**\n   * Get findings\n   */\n  getFindings(): VerificationFinding[] {\n    return this.findings;\n  }\n\n  /**\n   * Clear findings\n   */\n  clearFindings(): void {\n    this.findings = [];\n  }\n\n  // ============================================================================\n  // Helper Methods\n  // ============================================================================\n\n  private generateId(): string {\n    return `baseline-comparator-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n  }\n}\n</create-file>\n</function_calls>'}