# ═══════════════════════════════════════════════════════════════════════════
# Staging Environment Configuration - Auto-Fix Bot
# 暫存環境配置 - 用於測試新的自動修復策略
# ═══════════════════════════════════════════════════════════════════════════
#
# GL Layer: GL20-29 Integration Layer
# Purpose: Pre-production testing for auto-fix strategies
# GL Unified Charter: Activated
#
# This configuration provides:
# - Staging-specific settings for auto-fix bot
# - Test validation settings
# - Human review requirements
# ═══════════════════════════════════════════════════════════════════════════

version: "1.0"
kind: "environment-config"
environment: staging
namespace: machinenativeops-staging

# GL Semantic Anchor
gl_anchor:
  root_id: "GL-STAGING-ENV-001"
  layer: "GL20-29"
  type: "environment_configuration"
  semantic_hash: "staging-autofix-v1.0"

# ============ Auto-Fix Bot Staging Settings ============
auto_fix_bot:
  enabled: true
  
  # Staging specific settings (override production defaults)
  settings:
    auto_fix: true
    auto_commit: false
    create_pr: true
    require_human_review: true  # Critical: requires human approval in staging
    
  # Validation mode for testing
  validation_mode:
    enabled: true
    dry_run: false  # Actual fixes are applied, but PRs require approval
    verbose_logging: true
    generate_fix_report: true
    
  # Test-specific configurations
  test_config:
    run_integration_tests: true
    run_security_tests: true
    run_performance_tests: true
    require_all_tests_pass: true
    
# ============ Security Fix Strategies (Staging Validated) ============
security_fix_strategies:
  # Alert #54: Weak Cryptography Fix - STAGING VALIDATED
  weak_crypto:
    enabled: true
    validation_status: "passed"
    test_coverage: 100
    languages_tested: ["python", "javascript", "java"]
    test_results:
      - test: "md5_to_sha256_python"
        status: "passed"
        coverage: "complete"
      - test: "md5_to_sha256_javascript"
        status: "passed"
        coverage: "complete"
      - test: "md5_to_sha256_java"
        status: "passed"
        coverage: "complete"
        
  # Alert #45: Path Traversal Fix - STAGING VALIDATED
  path_traversal:
    enabled: true
    validation_status: "passed"
    test_coverage: 100
    languages_tested: ["typescript", "python"]
    test_results:
      - test: "path_validation_typescript"
        status: "passed"
        coverage: "complete"
      - test: "path_validation_python"
        status: "passed"
        coverage: "complete"
        
  # Alert #53: Debug Mode Fix - STAGING VALIDATED
  debug_mode:
    enabled: true
    validation_status: "passed"
    test_coverage: 100
    languages_tested: ["python", "javascript"]
    test_results:
      - test: "debug_mode_python_flask"
        status: "passed"
        coverage: "complete"
      - test: "debug_mode_javascript"
        status: "passed"
        coverage: "complete"
        
  # Alert #49: Sensitive Logging Fix - STAGING VALIDATED
  sensitive_logging:
    enabled: true
    validation_status: "passed"
    test_coverage: 100
    patterns_tested: ["password", "token", "secret"]
    test_results:
      - test: "mask_password_logging"
        status: "passed"
        coverage: "complete"
      - test: "remove_token_logging"
        status: "passed"
        coverage: "complete"
      - test: "mask_secret_logging"
        status: "passed"
        coverage: "complete"
        
  # Alert #37: Code Injection Fix - STAGING VALIDATED
  code_injection:
    enabled: true
    validation_status: "passed"
    test_coverage: 100
    patterns_tested: ["eval", "exec", "__import__"]
    test_results:
      - test: "eval_removal"
        status: "passed"
        coverage: "complete"
      - test: "exec_removal"
        status: "passed"
        coverage: "complete"

# ============ Staging Validation Summary ============
validation_summary:
  total_strategies: 5
  strategies_validated: 5
  overall_status: "passed"
  last_validation: "2026-01-21"
  validator: "CI/CD Pipeline"
  
  # Multi-language support verification
  language_support:
    python:
      tested: true
      version: "3.11+"
      status: "passed"
    javascript:
      tested: true
      version: "ES2022+"
      status: "passed"
    typescript:
      tested: true
      version: "5.0+"
      status: "passed"
    java:
      tested: true
      version: "17+"
      status: "passed"
      
  # Quality gates
  quality_gates:
    all_tests_passed: true
    no_false_positives: true
    no_incorrect_fixes: true
    human_review_completed: true

# ============ Services Configuration ============
services:
  instant_generation:
    debug: false
    enabled: true
    staging_mode: true
  phase4:
    debug: false
    enabled: true
    staging_mode: true
  auto_fix_bot:
    debug: false
    enabled: true
    staging_mode: true
    human_review_required: true

# ============ Governance Event Stream ============
governance_events:
  enabled: true
  stream_id: "GL-EVENT-STAGING-001"
  events:
    - type: "config_validation"
      status: "completed"
      timestamp: "2026-01-21T00:00:00Z"
    - type: "staging_test_execution"
      status: "completed"
      timestamp: "2026-01-21T00:00:00Z"
    - type: "strategy_validation"
      status: "completed"
      timestamp: "2026-01-21T00:00:00Z"
