# @GL-governed
# @GL-layer: GL90-99
# @GL-semantic: governed-configuration
# @GL-audit-trail: engine/governance/GL_SEMANTIC_ANCHOR.json

# Test workflow for setup-yq action
name: Test yq Action

on:
  workflow_dispatch:

permissions:
  contents: read
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  test-yq:
    runs-on: ubuntu-latest
    name: Test yq installation
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v6
        
      - name: Setup yq
        uses: ./.github/actions/setup-yq
        
      - name: Verify yq installation
        run: |
          echo "Checking yq version..."
          yq --version
          
      - name: Test yq with project config
        run: |
          if [ -f "machinenativeops.yaml" ]; then
            echo "Reading version from machinenativeops.yaml..."
            VERSION=$(yq eval '.version' machinenativeops.yaml)
            echo "Project version: $VERSION"
          else
            echo "machinenativeops.yaml not found, creating test file..."
            echo 'version: "1.0.0"' > test.yaml
            VERSION=$(yq eval '.version' test.yaml)
            echo "Test version: $VERSION"
          fi
          
      - name: Test yq parsing
        run: |
          echo "name: test" > test.yaml
          echo "version: 1.2.3" >> test.yaml
          echo "metadata:" >> test.yaml
          echo "  author: MachineNativeOps" >> test.yaml
          
          echo "Testing yq eval..."
          yq eval '.name' test.yaml
          yq eval '.version' test.yaml
          yq eval '.metadata.author' test.yaml
          
          echo "âœ… All yq tests passed!"
