# @GL-governed
# @GL-layer: CI/CD
# @GL-semantic: workflow-validation
# @GL-audit-trail: ../../engine/governance/GL_SEMANTIC_ANCHOR.json
#
# GL Unified Charter Activated
# @GL-governed
# @GL-layer: CI/CD
# @GL-semantic: workflow-validation
# @GL-audit-trail: ../../engine/governance/GL_SEMANTIC_ANCHOR.json
#
# GL Unified Charter Activated
# @GL-governed
# @GL-layer: CI/CD
# @GL-semantic: workflow-validation
# @GL-audit-trail: ../../engine/governance/GL_SEMANTIC_ANCHOR.json
#
# GL Unified Charter Activated
name: Website Vulnerability Check

on:
  # Run on schedule (daily at 2 AM UTC)
  schedule:
    - cron: '0 2 * * *'
  
  # Allow manual trigger
  workflow_dispatch:
  
  # Run on pushes to main that affect the static site
  push:
    branches: [ main ]
    paths:
      - 'docs/**'
      - '**.html'
      - '**.md'
      - '.github/workflows/static.yml'
      - '.github/workflows/website-vulnerability-check.yml'

permissions:
  contents: read
  issues: write

# Prevent concurrent runs
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  check-vulnerability:
    name: Check Website for Vulnerabilities
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:
      - name: Checkout code
        uses: actions/checkout@v6
        with:
          fetch-depth: 1

      - name: Is Website vulnerable
        uses: lirantal/is-website-vulnerable@1.15.10
        with:
          scan-url: 'https://machinenativeops.com'

      - name: Vulnerability check summary
        if: always()
        run: |
          echo "## ðŸ”’ Website Vulnerability Check" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Website scanned:** https://machinenativeops.com" >> $GITHUB_STEP_SUMMARY
          echo "**Scan time:** $(date -u '+%Y-%m-%d %H:%M:%S UTC')" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          if [ "${{ job.status }}" == "success" ]; then
            echo "âœ… No known vulnerabilities detected" >> $GITHUB_STEP_SUMMARY
          else
            echo "âš ï¸ Vulnerabilities may have been detected - check action logs" >> $GITHUB_STEP_SUMMARY
          fi
