# @GL-governed
# @GL-layer: GL10-29
# @GL-semantic: ci-cd-workflow-governance-validation
# @GL-audit-trail: ../../engine/governance/GL_SEMANTIC_ANCHOR.json

name: GL Governance Validation

on:
  push:
    branches:
      - main
      - 'gl/**'
      - 'engine/**'
      - 'file-organizer-system/**'
      - 'instant/**'
      - 'elasticsearch-search-system/**'
      - 'infrastructure/**'
      - 'esync-platform/**'
      - '.github/**'
      - 'gl-gate/**'
  pull_request:
    branches:
      - main
  workflow_dispatch:
    inputs:
      validation_mode:
        description: 'Validation mode'
        required: true
        default: 'strict'
        type: choice
        options:
          - strict
          - standard
  schedule:
    - cron: '0 0 * * *'

jobs:
  gl-engine-validation:
    name: GL Engine Module Validation
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Validate Engine GL Markers
        run: |
          cd engine && npm run validate-gl
        continue-on-error: false

  gl-file-organizer-validation:
    name: GL File Organizer Validation
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Validate File Organizer GL Markers
        run: |
          cd file-organizer-system && npm run validate-gl
        continue-on-error: false

  gl-instant-validation:
    name: GL Instant System Validation
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Validate Instant System GL Markers
        run: |
          cd instant && npm run validate-gl
        continue-on-error: false

  gl-elasticsearch-validation:
    name: GL Elasticsearch Validation
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Validate Elasticsearch GL Markers
        run: |
          cd elasticsearch-search-system && npm run validate-gl
        continue-on-error: false

  gl-infrastructure-validation:
    name: GL Infrastructure Validation
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Validate Infrastructure GL Markers
        run: |
          cd infrastructure && npm run validate-gl
        continue-on-error: false

  gl-esync-platform-validation:
    name: GL ESync Platform Validation
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Validate ESync Platform GL Markers
        run: |
          cd esync-platform && npm run validate-gl
        continue-on-error: false

  gl-gate-validation:
    name: GL Gate Validation
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Validate GL Gate Configuration
        run: |
          cd engine/gl-gate && npm run validate-gates
        continue-on-error: false

  gl-gate-execution:
    name: GL Gate Execution
    needs:
      - gl-engine-validation
      - gl-file-organizer-validation
      - gl-instant-validation
      - gl-elasticsearch-validation
      - gl-infrastructure-validation
      - gl-esync-platform-validation
      - gl-gate-validation
    runs-on: ubuntu-latest
    if: always()
    steps:
      - uses: actions/checkout@v4
      - name: Execute GL Gate Validation
        run: |
          cd engine/gl-gate && npm run validate-gates:strict
        continue-on-error: false

  global-audit-report:
    name: Global Audit Report
    needs:
      - gl-engine-validation
      - gl-file-organizer-validation
      - gl-instant-validation
      - gl-elasticsearch-validation
      - gl-infrastructure-validation
      - gl-esync-platform-validation
      - gl-gate-validation
      - gl-gate-execution
    runs-on: ubuntu-latest
    if: always()
    steps:
      - uses: actions/checkout@v4
      - name: Generate Global Audit Report
        run: |
          cd engine && npm run generate-global-audit
        continue-on-error: false
      - name: Upload Audit Report
        uses: actions/upload-artifact@v4
        with:
          name: global-audit-report
          path: engine/.governance/audit-reports/global-governance-audit-report.json