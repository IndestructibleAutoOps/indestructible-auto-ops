# NG00701: 命名空間審計追蹤
# Namespace Audit Trail

apiVersion: ng.governance/v3
kind: AuditSpecification
metadata:
  ng_code: NG00701
  name: namespace-audit-trail
  version: "1.0.0"
  parent: NG00000
  domain: "審計"
  status: active

spec:
  purpose: "定義命名空間變更的完整審計追蹤規範"
  
  audit_events:
    namespace_lifecycle:
      registered:
        ng_code: "NG00701"
        severity: "INFO"
        required_fields:
          - "namespace_id"
          - "ng_code"
          - "actor"
          - "timestamp"
      
      activated:
        ng_code: "NG00702"
        severity: "INFO"
        required_fields:
          - "namespace_id"
          - "deployment_target"
          - "actor"
      
      deprecated:
        ng_code: "NG00703"
        severity: "WARNING"
        required_fields:
          - "namespace_id"
          - "deprecation_reason"
          - "migration_plan"
      
      migrated:
        ng_code: "NG00704"
        severity: "INFO"
        required_fields:
          - "source_namespace"
          - "target_namespace"
          - "migration_type"
      
      archived:
        ng_code: "NG00705"
        severity: "INFO"
        required_fields:
          - "namespace_id"
          - "archive_location"
          - "retention_period"
      
      destroyed:
        ng_code: "NG00706"
        severity: "WARNING"
        required_fields:
          - "namespace_id"
          - "destruction_approval"
          - "final_audit_report"
    
    namespace_operations:
      accessed:
        ng_code: "NG00711"
        severity: "DEBUG"
        sampling_rate: 0.1  # 10% 採樣
      
      modified:
        ng_code: "NG00712"
        severity: "INFO"
        required_fields:
          - "modified_fields"
          - "old_values"
          - "new_values"
      
      permission_changed:
        ng_code: "NG00713"
        severity: "WARNING"
        required_fields:
          - "permission_type"
          - "granted_to"
          - "granted_by"
      
      conflict_detected:
        ng_code: "NG00714"
        severity: "ERROR"
        required_fields:
          - "conflict_type"
          - "conflicting_namespaces"
          - "resolution_action"
  
  audit_storage:
    primary_storage:
      type: "immutable_database"
      retention: "10 years"
      encryption: "AES-256"
    
    backup_storage:
      type: "cold_storage"
      retention: "permanent"
      location: "archive"
    
    real_time_stream:
      type: "event_stream"
      consumers:
        - "monitoring_dashboard"
        - "alert_system"
        - "analytics_engine"
  
  audit_query:
    supported_queries:
      by_namespace:
        description: "查詢特定命名空間的所有審計記錄"
        index: "namespace_id"
      
      by_actor:
        description: "查詢特定執行者的所有操作"
        index: "actor"
      
      by_time_range:
        description: "查詢時間範圍內的審計記錄"
        index: "timestamp"
      
      by_event_type:
        description: "查詢特定類型的事件"
        index: "event_type"
      
      by_severity:
        description: "查詢特定嚴重性的事件"
        index: "severity"
  
  compliance_reporting:
    daily_summary:
      ng_code: "NG00720"
      metrics:
        - "total_events"
        - "events_by_type"
        - "events_by_severity"
        - "unique_namespaces_accessed"
    
    weekly_report:
      ng_code: "NG00721"
      includes:
        - "namespace_lifecycle_summary"
        - "permission_changes"
        - "conflicts_detected_and_resolved"
        - "migration_activities"
    
    monthly_compliance:
      ng_code: "NG00722"
      includes:
        - "governance_metrics"
        - "policy_violations"
        - "remediation_actions"
        - "trend_analysis"

enforcement:
  audit_all_events: true
  real_time_logging: true
  tamper_protection: "cryptographic_signing"
  retention_enforcement: "automated"
