# Contract Schema
# @GL-governed
# @GL-layer: GL30-49
# @GL-semantic: contract-schema
#
# Schema for contract.yaml files in the governance ecosystem

$schema: "http://json-schema.org/draft-07/schema#"
$id: "https://machine-native-ops.io/schemas/contract.yaml"
title: "Contract Schema"
description: "Schema for governance contracts defining inputs and outputs"

type: object

required:
  - id
  - inputs
  - outputs

properties:
  id:
    type: string
    description: "Unique contract identifier"
    pattern: "^CTR-[A-Z0-9-]+$"
    examples:
      - "CTR-ENFORCE-001"
      - "CTR-BUILD-VALIDATE"
  
  name:
    type: string
    description: "Human-readable contract name"
  
  description:
    type: string
    description: "Contract description"
  
  version:
    type: string
    description: "Contract version"
    pattern: "^\\d+\\.\\d+\\.\\d+$"
  
  inputs:
    type: array
    description: "Contract input specifications"
    items:
      type: object
      required:
        - name
        - type
      properties:
        name:
          type: string
          description: "Input parameter name"
        type:
          type: string
          description: "Input data type"
          enum:
            - string
            - number
            - boolean
            - array
            - object
            - file
            - directory
        required:
          type: boolean
          default: true
        description:
          type: string
        schema:
          type: string
          description: "Reference to input schema"
        default:
          description: "Default value"
  
  outputs:
    type: array
    description: "Contract output specifications"
    items:
      type: object
      required:
        - name
        - type
      properties:
        name:
          type: string
          description: "Output parameter name"
        type:
          type: string
          description: "Output data type"
          enum:
            - string
            - number
            - boolean
            - array
            - object
            - file
            - report
        description:
          type: string
        schema:
          type: string
          description: "Reference to output schema"
  
  preconditions:
    type: array
    description: "Contract preconditions"
    items:
      type: object
      properties:
        id:
          type: string
        condition:
          type: string
        error_message:
          type: string
  
  postconditions:
    type: array
    description: "Contract postconditions"
    items:
      type: object
      properties:
        id:
          type: string
        condition:
          type: string
        error_message:
          type: string
  
  sla:
    type: object
    description: "Service Level Agreement"
    properties:
      max_duration:
        type: string
        description: "Maximum execution duration"
        pattern: "^\\d+[smh]$"
      retry_count:
        type: integer
        minimum: 0
        maximum: 10
      timeout:
        type: string
        pattern: "^\\d+[smh]$"
  
  metadata:
    type: object
    description: "Contract metadata"
    properties:
      layer:
        type: string
        pattern: "^GL\\d{2}-\\d{2}$"
      semantic:
        type: string
      created:
        type: string
        format: date-time
      updated:
        type: string
        format: date-time
      author:
        type: string

additionalProperties: false

examples:
  - id: "CTR-ENFORCE-001"
    name: "Governance Enforcement Contract"
    description: "Contract for running governance enforcement"
    version: "1.0.0"
    inputs:
      - name: project_root
        type: directory
        required: true
        description: "Root directory of the project"
      - name: strict_mode
        type: boolean
        required: false
        default: false
    outputs:
      - name: report
        type: report
        description: "Enforcement report"
      - name: violations
        type: array
        description: "List of violations"
    sla:
      max_duration: "5m"
      retry_count: 3
    metadata:
      layer: "GL30-49"
      semantic: "enforcement-contract"
