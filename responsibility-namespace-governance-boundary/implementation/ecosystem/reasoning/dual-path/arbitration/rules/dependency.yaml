# Dependency-Related Arbitration Rules
# MNGA Layer 6 - Reasoning System

apiVersion: arbitration.mnga.io/v1
kind: ArbitrationRules
metadata:
  name: dependency-rules
  description: "Rules for dependency version and package decision making"

rules:
  dependency_version_update:
    description: "Require careful assessment for dependency version updates"
    priority: 1
    condition:
      type: "and"
      conditions:
        - field_match:
            field: "internal.metadata.type"
            value: "dependency"
        - field_match:
            field: "external.metadata.type"
            value: "dependency"
        - field_not_equal:
            field1: "internal.metadata.version"
            field2: "external.metadata.version"
    decision: "HYBRID"
    reason: "Dependency version updates require compatibility assessment and testing"
    severity: "HIGH"
    requirement: "require_human_review"
    
  critical_dependency:
    description: "Prefer internal configuration for critical dependencies"
    priority: 2
    condition:
      type: "and"
      conditions:
        - field_in_list:
            field: "internal.metadata.name"
            list: ["kubernetes", "docker", "nginx", "postgresql"]
        - field_match:
            field: "internal.confidence"
            operator: ">"
            value: 0.7
    decision: "INTERNAL"
    reason: "Critical infrastructure dependencies use tested internal configurations"
    severity: "HIGH"
    
  security_patch:
    description: "Apply security patches immediately"
    priority: 3
    condition:
      type: "and"
      conditions:
        - field_match:
            field: "external.metadata.category"
            value: "security"
        - field_match:
            field: "external.metadata.type"
            value: "patch"
    decision: "EXTERNAL"
    reason: "Security patches should be applied following external recommendations"
    severity: "CRITICAL"
    action: "apply_immediately"
    
  dependency_deprecation:
    description: "Replace deprecated dependencies"
    priority: 4
    condition:
      type: "field_match"
      field: "external.metadata.status"
      value: "deprecated"
    decision: "EXTERNAL"
    reason: "Deprecated dependencies must be replaced with recommended alternatives"
    severity: "HIGH"
    requirement: "require_migration_plan"
    
  development_dependency:
    description: "Use external best practices for development tools"
    priority: 5
    condition:
      type: "and"
      conditions:
        - field_match:
            field: "internal.metadata.scope"
            value: "development"
        - field_match:
            field: "external.confidence"
            operator: ">"
            value: 0.85
    decision: "EXTERNAL"
    reason: "Development dependencies can follow external best practices"
    severity: "LOW"