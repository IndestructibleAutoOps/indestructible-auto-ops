#
# @GL-governed
# @GL-layer: GL90-99
# @GL-semantic: governance
# @GL-audit-trail: ../../governance/GL_SEMANTIC_ANCHOR.json
#
# Meta-Governance Configuration
# GL Governance Layer: GL90-99 (Meta-Specification Layer)

apiVersion: governance.ecosystem/v1
kind: MetaGovernanceConfig
metadata:
  name: meta-governance-config
  version: "1.0.0"

# Version Management
version_management:
  # 語義化版本控制
  semver:
    enabled: true
    format: "MAJOR.MINOR.PATCH"
  
  # LTS 支持
  lts:
    enabled: true
    support_period: 730  # 2年
    
  # 版本策略
  policy:
    major_version_approval: [architect, cto]
    minor_version_approval: [tech_lead]
    patch_version_approval: [team_lead]

# Change Management
change_management:
  # 變更流程
  workflow:
    - stage: proposal
      required: [title, description, impact_assessment]
    - stage: assessment
      automated: true
    - stage: review
      required_approvals: 2
    - stage: implementation
      testing_required: true
    - stage: deployment
      rollback_plan_required: true
  
  # 影響級別配置
  impact_levels:
    low:
      approval_required: [team_lead]
      testing_required: unit
    medium:
      approval_required: [team_lead, tech_lead]
      testing_required: integration
    high:
      approval_required: [team_lead, tech_lead, architect]
      testing_required: full
      rollback_plan_required: true
    critical:
      approval_required: [team_lead, tech_lead, architect, cto]
      testing_required: full
      rollback_plan_required: true
      shadow_deployment: true

# Review Mechanism
review_mechanism:
  # 三層審查
  layers:
    technical:
      reviewers: [dev_team, qa_team]
      focus: [code_quality, security, performance]
    
    architecture:
      reviewers: [architect, tech_lead]
      focus: [scalability, dependencies, design_patterns]
    
    business:
      reviewers: [product_owner, domain_expert]
      focus: [requirements, usability, business_value]
  
  # 審查規則
  rules:
    min_approvals_per_layer: 1
    rejection_blocks_approval: true
    timeout_days: 7

# Dependency Management
dependency_management:
  # 依賴規則
  rules:
    max_depth: 3  # 最大依賴深度
    max_dependencies: 20  # 最大依賴數量
    circular_dependencies: forbidden
  
  # 安全掃描
  security:
    enabled: true
    vulnerability_check: true
    license_check: true
  
  # 更新策略
  update_policy:
    auto_update_patch: false
    security_updates: immediate
    breaking_changes: manual

# Lifecycle Management
lifecycle:
  # 階段定義
  stages:
    - design
    - development
    - testing
    - deployment
    - monitoring
    - deprecation
    - archival
  
  # 棄用策略
  deprecation:
    warning_versions: 3  # 提前3個版本警告
    migration_guide_required: true
    sunset_period_days: 180
  
  # 歸檔策略
  archival:
    readonly_retention: true
    documentation_removal: true
    code_preservation: 365  # 保留1年

# RASCI Model
responsibility:
  # 角色定義
  roles:
    responsible: [tech_lead]  # 負責人
    accountable: [architect]  # 審批者
    support: [dev_team, ops_team]  # 執行者
    consult: [domain_expert, security_expert]  # 顧問
    inform: [stakeholders, users]  # 知會者
  
  # 審計追蹤
  audit:
    enabled: true
    immutable_log: true
    retention_days: 730

# Governance Tokens (Optional - for DAO-style governance)
governance_tokens:
  enabled: false
  
  voting_weight:
    formula: "base_tokens * time_lock_multiplier * participation_coefficient"
    time_lock_multipliers:
      - duration_days: 30
        multiplier: 1.0
      - duration_days: 90
        multiplier: 1.5
      - duration_days: 180
        multiplier: 2.0
      - duration_days: 365
        multiplier: 4.0
  
  voting_rules:
    quorum_percentage: 20
    approval_threshold: 66
    veto_threshold: 33

# Automation
automation:
  llm_as_judge:
    enabled: false
    model: gpt-4
    checks: [format_validation, pattern_matching]
  
  ci_cd_integration:
    enabled: true
    gates: [tests, security_scan, dependency_check]

# Monitoring
monitoring:
  metrics:
    enabled: true
    track: [version_releases, change_requests, review_duration]
  
  logging:
    level: INFO
    format: json
