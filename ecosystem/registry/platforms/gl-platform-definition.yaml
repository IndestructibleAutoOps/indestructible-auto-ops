#
# @GL-governed
# @GL-layer: GL10-29
# @GL-semantic: registry
# @GL-audit-trail: ../../governance/GL_SEMANTIC_ANCHOR.json
#
apiVersion: platform.gl/v1
kind: PlatformDefinition
metadata:
  name: gl-platform-definition
  version: "1.0.0"
  description: "GL 平台定義規範 - 定義平台這個語意單位的語法、語意與執行語境"
  category: governance
  compliance:
    - gl-enterprise-architecture
    - gl-boundary-enforcement
    - gl-meta-specifications

spec:
  # 1. 平台的核心定義
  platformDefinition: |
    在 GL 架構中，一個「平台」是：
    一個具備獨立命名空間、可被註冊、可被治理、可被擴展、可被協調的語意單位，
    並且實作一組明確的能力（capabilities），符合 GL 的治理層級與契約規範。

  # 2. 平台的構成條件（Platform Definition Criteria）
  requiredElements:
    - id: "gl-namespace"
      description: "必須符合 gl.{domain}.{capability}-platform 命名規範"
      validation: "regex: ^gl\\.[a-z]+\\.[a-z]+-platform$"
      required: true

    - id: "platform-manifest"
      description: "必須在 registry/platform-registry/platform-manifest.yaml 中註冊"
      validation: "file-exists: registry/platform-registry/platform-manifest.yaml"
      required: true

    - id: "platform-template"
      description: "必須繼承自 platform-templates/ 中的某個模板"
      validation: "template-inheritance: core|cloud|on-premise|edge"
      required: true

    - id: "capabilities"
      description: "必須定義其支援的能力"
      validation: "non-empty-list: true"
      required: true

    - id: "governance"
      description: "必須聲明其遵循的治理層級"
      validation: "includes: gl-enterprise-architecture, gl-boundary-enforcement"
      required: true

    - id: "location"
      description: "必須實體存在於 platforms/{platform-id}/ 目錄下"
      validation: "directory-exists: platforms/{platform-id}"
      required: true

    - id: "compliance"
      description: "必須通過 GL 合約驗證器"
      validation: "passes-governance-validator: true"
      required: true

  # 3. 平台的語意邊界（Platform Responsibility Boundary）
  semanticBoundaries:
    - definition: "一個平台 = 一個獨立命名空間（gl.xxx.yyy-platform）"
      enforcement: "命名空間驗證器"

    - definition: "一個平台 = 一個 platform-manifest.yaml"
      enforcement: "Manifest 註冊驗證器"

    - definition: "一個平台 = 一個 coordination context（可被 service-discovery / data-sync / api-gateway 協調）"
      enforcement: "Coordination 註冊驗證器"

    - definition: "一個平台 = 一個治理單位（可被 GL60-80 邊界規則驗證）"
      enforcement: "邊界執行驗證器"

    - definition: "一個平台 = 一個可被擴展的實體（支援 GL81-83 extension framework）"
      enforcement: "擴展框架驗證器"

  # 4. 平台的語意分類（Platform Domain Taxonomy）
  domainTaxonomy:
    - domain: gl.ai
      description: "AI 模型與代理平台"
      examples:
        - gl.ai.gpt-platform
        - gl.ai.claude-platform
        - gl.ai.deepseek-platform

    - domain: gl.runtime
      description: "執行時與核心運算平台"
      examples:
        - gl.runtime.core-platform
        - gl.runtime.sync-platform
        - gl.runtime.quantum-platform

    - domain: gl.dev
      description: "開發工具與工程平台"
      examples:
        - gl.dev.iac-platform
        - gl.dev.review-platform

    - domain: gl.api
      description: "API 接入與整合平台"
      examples:
        - gl.api.supabase-platform
        - gl.api.notion-platform

    - domain: gl.db
      description: "資料庫與儲存平台"
      examples:
        - gl.db.planetscale-platform

    - domain: gl.ide
      description: "編輯器與 IDE 插件平台"
      examples:
        - gl.ide.copilot-platform
        - gl.ide.vscode-platform
        - gl.ide.replit-platform
        - gl.ide.preview-platform

    - domain: gl.edge
      description: "邊緣部署平台"
      examples:
        - gl.edge.vercel-platform

    - domain: gl.web
      description: "前端與網站平台"
      examples:
        - gl.web.wix-platform

    - domain: gl.design
      description: "設計工具平台"
      examples:
        - gl.design.figma-platform
        - gl.design.sketch-platform

    - domain: gl.doc
      description: "文件與知識平台"
      examples:
        - gl.doc.gitbook-platform

    - domain: gl.edu
      description: "教育與學習平台"
      examples:
        - gl.edu.sololearn-platform

    - domain: gl.bot
      description: "對話與聊天代理平台"
      examples:
        - gl.bot.poe-platform

    - domain: gl.mcp
      description: "多模態與控制平台"
      examples:
        - gl.mcp.multimodal-platform
        - gl.mcp.cursor-platform

    - domain: gl.experimental
      description: "實驗性平台"
      note: "用於實驗性、不保證穩定性的平台"

    - domain: gl.local
      description: "本地開發平台"
      note: "用於本地開發與測試平台"

    - domain: gl.legacy
      description: "已退役平台"
      note: "已退役、不再維護的平台"

    - domain: gl.automation
      description: "自動化與編排平台"
      examples:
        - gl.automation.instant-platform
        - gl.automation.organizer-platform

    - domain: gl.data
      description: "資料處理平台"
      examples:
        - gl.data.processing-platform

    - domain: gl.monitoring
      description: "監控與可觀測性平台"
      examples:
        - gl.monitoring.observability-platform
        - gl.monitoring.system-platform

    - domain: gl.search
      description: "搜尋引擎平台"
      examples:
        - gl.search.elasticsearch-platform

    - domain: gl.governance
      description: "治理平台"
      examples:
        - gl.governance.architecture-platform
        - gl.governance.compliance-platform

    - domain: gl.infrastructure
      description: "基礎設施平台"
      examples:
        - gl.infrastructure.foundation-platform

    - domain: gl.extension
      description: "擴展服務平台"
      examples:
        - gl.extension.services-platform

    - domain: gl.integration
      description: "整合平台"
      examples:
        - gl.integration.hub-platform

    - domain: gl.meta
      description: "元規範平台"
      examples:
        - gl.meta.specifications-platform

    - domain: gl.shared
      description: "共享組件平台"
      examples:
        - gl.shared.components-platform

    - domain: gl.platform
      description: "平台核心平台"
      examples:
        - gl.platform.core-platform

    - domain: gl.quantum
      description: "量子運算平台"
      examples:
        - gl.quantum.computing-platform

  # 5. 平台的生命週期（Platform Lifecycle）
  lifecycle:
    phases:
      - phase: draft
        description: "尚未註冊，開發中"
        actions:
          - "創建平台目錄結構"
          - "實作核心功能"
          - "準備 manifest 檔案"

      - phase: active
        description: "已註冊，正式運行"
        actions:
          - "在 registry 中註冊"
          - "通過治理驗證"
          - "部署到生產環境"
          - "開啟協調服務"

      - phase: experimental
        description: "實驗性平台，不保證穩定性"
        actions:
          - "標記為 gl.experimental domain"
          - "限制生產使用"
          - "啟用實驗性功能"

      - phase: deprecated
        description: "已退役，不再維護"
        actions:
          - "標記為 deprecated 狀態"
          - "提供遷移指南"
          - "計劃移除日期"

  # 6. 平台的治理驗證（Platform Compliance）
  complianceChecks:
    - check: "naming-validation"
      tool: "gl-platforms-validator.rego"
      description: "驗證命名符合 gl.{domain}.{capability}-platform 規範"

    - check: "structure-validation"
      tool: "directory-validator"
      description: "驗證平台存在於 platforms/ 目錄下"

    - check: "registry-validation"
      tool: "manifest-validator"
      description: "驗證平台已註冊於 registry"

    - check: "capability-validation"
      tool: "capability-validator"
      description: "驗證平台實作所聲明的 capabilities"

    - check: "boundary-validation"
      tool: "boundary-enforcement"
      description: "驗證平台符合 GL60-80 邊界規則"

    - check: "extension-validation"
      tool: "extension-validator"
      description: "驗證平台支援 GL81-83 擴展框架"

  # 7. 平台放置規則（Platform Placement Rules）
  placementRules:
    - rule: "contract-platforms"
      description: "所有契約定義的平台必須位於 platforms/ 目錄"
      criteria: "platform_id in gl-platforms.yaml"
      location: "platforms/"
      enforcement: "STRICT"

    - rule: "custom-platforms"
      description: "非契約平台可位於 root/ 或 custom/ 目錄"
      criteria: "platform_id not in gl-platforms.yaml"
      location: "root/ or custom/"
      enforcement: "FLEXIBLE"

    - rule: "experimental-platforms"
      description: "實驗性平台應標記 gl.experimental domain"
      criteria: "domain == gl.experimental"
      location: "platforms/experimental/"
      enforcement: "RECOMMENDED"

    - rule: "deprecated-platforms"
      description: "已退役平台應移至 deprecated/ 目錄"
      criteria: "status == deprecated"
      location: "platforms/deprecated/"
      enforcement: "REQUIRED"

    - rule: "no-duplicates"
      description: "禁止平台在多個位置重複存在"
      criteria: "count(platform_id locations) == 1"
      enforcement: "CRITICAL"

  # 8. 平台協調與擴展（Platform Coordination & Extension）
  coordination:
    serviceDiscovery:
      enabled: true
      protocol: "gl-coordination-protocol"
      registry: "ecosystem/registry/platform-registry"

    dataSynchronization:
      enabled: true
      protocols:
        - "event-driven"
        - "pull-based"
      validation: "data-integrity-check"

    apiGateway:
      enabled: true
      routes: "automatically-generated"
      documentation: "auto-generated"

  extensionFramework:
    supportedLayers:
      - gl81-83
    extensionPoints:
      - name: "custom-capabilities"
        type: "plugin"
        location: "extensions/capabilities/"
      - name: "custom-governance"
        type: "policy"
        location: "extensions/governance/"
      - name: "custom-coordination"
        type: "protocol"
        location: "extensions/coordination/"

  # 9. 平台驗證器規則（Validator Rules）
  validationRules:
    - rule: "GL-PD-001"
      name: "命名格式驗證"
      level: "CRITICAL"
      check: "platform_id matches ^gl\\.[a-z]+\\.[a-z]+-platform$"
      message: "平台名稱必須符合 gl.{domain}.{capability}-platform 格式"

    - rule: "GL-PD-002"
      name: "單一位置驗證"
      level: "CRITICAL"
      check: "platform exists in exactly one location"
      message: "平台不能在多個位置重複存在"

    - rule: "GL-PD-003"
      name: "契約註冊驗證"
      level: "HIGH"
      check: "platform registered in gl-platforms.yaml"
      message: "契約平台必須在 gl-platforms.yaml 中註冊"

    - rule: "GL-PD-004"
      name: "Manifest 存在驗證"
      level: "HIGH"
      check: "platform-manifest.yaml exists in registry"
      message: "平台必須在 registry 中有 manifest 檔案"

    - rule: "GL-PD-005"
      name: "目錄結構驗證"
      level: "MEDIUM"
      check: "platform directory has standard subdirectories"
      message: "平台目錄必須包含標準子目錄"

    - rule: "GL-PD-006"
      name: "Capabilities 定義驗證"
      level: "MEDIUM"
      check: "platform defines at least one capability"
      message: "平台必須定義至少一個能力"

    - rule: "GL-PD-007"
      name: "治理層級驗證"
      level: "MEDIUM"
      check: "platform declares governance layers"
      message: "平台必須聲明遵循的治理層級"

    - rule: "GL-PD-008"
      name: "擴展框架支援驗證"
      level: "LOW"
      check: "platform supports extension framework"
      message: "平台應支援 GL81-83 擴展框架"

  # 10. 平台模板系統（Platform Template System）
  templates:
    core:
      description: "核心平台模板"
      structure:
        - src/
        - configs/
        - docs/
        - tests/
        - deployments/
        - governance/
        - services/
        - data/
      requiredCapabilities:
        - "service-discovery"
        - "health-check"

    cloud:
      description: "雲端平台模板"
      extends: core
      additionalCapabilities:
        - "auto-scaling"
        - "load-balancing"
        - "cdn"

    on-premise:
      description: "內部部署平台模板"
      extends: core
      additionalCapabilities:
        - "local-network"
        - "hardware-management"

    edge:
      description: "邊緣平台模板"
      extends: core
      additionalCapabilities:
        - "edge-computing"
        - "low-latency"

  # 11. 平台註冊格式（Platform Manifest Schema）
  manifestSchema:
    requiredFields:
      - name
      - version
      - type
      - capabilities
      - governance
      - status
      - template

    optionalFields:
      - description
      - dependencies
      - coordination
      - extensions

    example: |
      name: gl.api.supabase-platform
      version: 1.0.0
      type: cloud
      capabilities:
        - service-discovery
        - data-synchronization
        - api-gateway
      governance:
        - gl-enterprise-architecture
        - gl-boundary-enforcement
        - gl-meta-specifications
        - gl-extension-framework
      status: active
      template: cloud-template
      description: "Supabase API 整合平台"
      dependencies: []
      coordination:
        enabled: true
      extensions: []