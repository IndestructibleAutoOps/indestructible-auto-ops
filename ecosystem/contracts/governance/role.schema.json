{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://mnga.ecosystem/schemas/role.schema.json",
  "title": "MNGA Role Definition Schema",
  "description": "Formal schema for defining roles in MNGA Role Execution Layer (L5.5)",
  "type": "object",
  "required": [
    "id",
    "name",
    "version",
    "description",
    "capabilities",
    "inputs",
    "outputs",
    "runtime_behavior",
    "semantic_tags",
    "governance_rules"
  ],
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^[a-z]+\\.[a-z-]+$",
      "description": "Role identifier in format: namespace.role-name (e.g., ecosystem.runner)"
    },
    "name": {
      "type": "string",
      "description": "Human-readable role name"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Semantic version (SemVer 2.0)"
    },
    "description": {
      "type": "string",
      "minLength": 10,
      "description": "Detailed role description"
    },
    "capabilities": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "minItems": 1,
      "description": "List of capabilities the role provides"
    },
    "inputs": {
      "type": "object",
      "description": "Input schema for the role",
      "properties": {
        "parameters": {
          "type": "object",
          "description": "Accepted parameters with types"
        },
        "artifacts": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Artifact types this role can process"
        },
        "required": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Required input parameters"
        }
      },
      "required": ["parameters"]
    },
    "outputs": {
      "type": "object",
      "description": "Output schema for the role",
      "properties": {
        "format": {
          "type": "string",
          "enum": ["json", "yaml", "markdown", "text"],
          "description": "Output format"
        },
        "schema": {
          "type": "object",
          "description": "Output schema structure"
        }
      },
      "required": ["format"]
    },
    "runtime_behavior": {
      "type": "object",
      "description": "Runtime execution behavior",
      "properties": {
        "execution_mode": {
          "type": "string",
          "enum": ["synchronous", "asynchronous", "streaming"],
          "description": "How the role executes"
        },
        "timeout": {
          "type": "integer",
          "minimum": 1,
          "description": "Maximum execution time in seconds"
        },
        "retry_policy": {
          "type": "object",
          "properties": {
            "max_retries": {
              "type": "integer",
              "minimum": 0
            },
            "backoff": {
              "type": "string",
              "enum": ["linear", "exponential"]
            }
          }
        },
        "hooks": {
          "type": "object",
          "properties": {
            "pre_execute": {
              "type": "string",
              "description": "Pre-execution hook script"
            },
            "post_execute": {
              "type": "string",
              "description": "Post-execution hook script"
            }
          }
        }
      },
      "required": ["execution_mode"]
    },
    "semantic_tags": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "minItems": 1,
      "description": "Semantic classification tags for governance"
    },
    "governance_rules": {
      "type": "object",
      "description": "Governance and compliance rules",
      "properties": {
        "permissions": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Required permissions"
        },
        "constraints": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "type": {
                "type": "string"
              },
              "rule": {
                "type": "string"
              },
              "severity": {
                "type": "string",
                "enum": ["CRITICAL", "HIGH", "MEDIUM", "LOW"]
              }
            }
          },
          "description": "Execution constraints"
        },
        "audit_required": {
          "type": "boolean",
          "description": "Whether this role requires audit logging"
        },
        "evidence_required": {
          "type": "boolean",
          "description": "Whether this role requires evidence chain"
        }
      },
      "required": ["audit_required", "evidence_required"]
    },
    "dependencies": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Role dependencies (e.g., other roles, tools)"
    },
    "mnga_layer": {
      "type": "string",
      "enum": ["L5", "L5.5", "L6"],
      "description": "MNGA layer this role belongs to"
    },
    "layer_interactions": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": ["L0", "L1", "L2", "L3", "L4", "L5", "L5.5", "L6", "L7"]
      },
      "description": "MNGA layers this role interacts with"
    }
  }
}