apiVersion: supplychain.machinenativeops.io/v1
kind: SBOMGenerator
metadata:
  name: gl-quantum-sbom-generator
  namespace: governance
  labels:
    gl-version: v10.0.0
    tier: quantum-supply-chain
spec:
  enabled: true
  format:
    - spdx
    - cyclonedx
    - syft-json
    
  generators:
    - name: syft
      tool: syft
      version: latest
      enabled: true
      scanTargets:
        - container-images
        - filesystem
        - directories
      options:
        scope: all-layers
        package-type: all
      
    - name: trivy
      tool: trivy
      version: latest
      enabled: true
      scanTargets:
        - container-images
        - filesystem
        - git-repositories
      options:
        security-checks:
          - vuln
          - config
          
  output:
    artifacts:
      path: artifacts/sbom
      retention: 365d
      compress: true
      
    upload:
      enabled: true
      destinations:
        - type: github-artifacts
          retention: 90d
          
        - type: s3
          bucket: gl-sbom-artifacts
          prefix: sbom/
          
  validation:
    verifySBOM:
      enabled: true
      requiredFields:
        - name
        - version
        - components
        
    compareSBOMs:
      enabled: true
      detectChanges:
        - added
        - removed
        - modified
        
  attestation:
    enabled: true
    signer: cosign
    keyLocation: ${{ secrets.SBOM_SIGNING_KEY }}