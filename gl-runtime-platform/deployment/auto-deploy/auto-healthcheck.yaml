# @GL-governed
# @GL-layer: GL90-99
# @GL-semantic: auto-healthcheck-configuration
# @GL-audit-trail: ../../../engine/governance/GL_SEMANTIC_ANCHOR.json
#
# GL Unified Charter Activated
# Version 3: Auto-Deploy Layer (Deployment Automation)

apiVersion: gl.machinenativeops.io/v1
kind: AutoHealthCheck
metadata:
  name: gl-runtime-health
  version: "1.0.0"
  created_at: "2026-01-28T00:00:00Z"
  layer: "GL90-99"
  annotations:
    governance.machinenativeops.io/classification: "internal"
    governance.machinenativeops.io/approval: "approved"

spec:
  enable: true
  
  interval_seconds: 30
  timeout_seconds: 10
  
  checks:
    - name: "orchestration-engine-health"
      type: "http"
      endpoint: "/api/v1/health"
      port: 8080
      expected_status: 200
      enabled: true
      
    - name: "governance-service-health"
      type: "http"
      endpoint: "/api/v1/status"
      port: 3001
      expected_status: 200
      enabled: true
      
    - name: "connector-service-health"
      type: "http"
      endpoint: "/api/v1/connectors/status"
      port: 3002
      expected_status: 200
      enabled: true
      
    - name: "storage-service-health"
      type: "tcp"
      port: 6379
      enabled: true
      
    - name: "pod-resource-usage"
      type: "k8s-metrics"
      metric: "cpu_usage"
      threshold_percent: 80
      enabled: true
      
  actions:
    on_failure:
      type: "auto-redeploy"
      max_retries: 3
      retry_interval_seconds: 60
      rollback_on_failure: true
      
    on_degraded:
      type: "alert"
      severity: "warning"
      channels:
        - "slack"
        - "email"
        
    on_success:
      type: "log"
      log_level: "info"
      
  escalation:
    enabled: true
    levels:
      - level: 1
        failure_count: 3
        action: "restart-pods"
      - level: 2
        failure_count: 5
        action: "rollback-deployment"
      - level: 3
        failure_count: 10
        action: "notify-escalation-team"
        
  monitoring:
    enabled: true
    metrics_port: 9090
    track_metrics:
      - "health_check_status"
      - "response_time"
      - "failure_count"
      - "action_taken"
      
status:
  phase: "ready"
  last_check: null
  check_count: 0
  conditions:
    - type: "AutoHealthCheckConfigured"
      status: "True"
      lastTransitionTime: "2026-01-28T00:00:00Z"
      reason: "Auto-healthcheck configuration loaded"
    - type: "HealthChecksDefined"
      status: "True"
      lastTransitionTime: "2026-01-28T00:00:00Z"
      reason: "Health check probes configured"