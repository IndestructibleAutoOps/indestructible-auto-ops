# @GL-governed
# @GL-layer: governance
# @GL-semantic: federation-policies
# @GL-charter-version: 2.0.0
# @GL-audit-trail: ../../engine/governance/GL_SEMANTIC_ANCHOR.json

apiVersion: federation.machinenativeops.io/v1
kind: FederationPolicies
metadata:
  name: federation-policies
  version: "7.0.0"
  created_at: "2026-01-28T00:00:00Z"
  layer: "GL90-99"
  owner: "engineering-team"
  annotations:
    governance.machinenativeops.io/classification: "internal"
    governance.machinenativeops.io/approval: "approved"
    governance.machinenativeops.io/charter-version: "2.0.0"
    governance.machinenativeops.io/semantic-enabled: "true"

spec:
  baseline_policies:
    - id: "semantic-analysis-required"
      name: "Semantic Analysis Required"
      enabled: true
      scope: "all"
      description: "All files must undergo semantic analysis and classification"
      rules:
        - type: "semantic_classification"
          enabled: true
          severity: "critical"
          check: "has_semantic_classification"
        - type: "gl_mapping"
          enabled: true
          severity: "critical"
          check: "has_gl_mapping"
      enforcement: "block"
      exceptions: []

    - id: "governance-tags-required"
      name: "Governance Tags Required"
      enabled: true
      scope: "all"
      description: "All governance files must have GL governance tags"
      rules:
        - type: "governance_tag"
          tag: "@GL-governed"
          required: true
          severity: "critical"
        - type: "governance_tag"
          tag: "@GL-layer:"
          required: true
          severity: "critical"
        - type: "governance_tag"
          tag: "@GL-semantic:"
          required: true
          severity: "critical"
        - type: "governance_tag"
          tag: "@GL-charter-version:"
          required: true
          severity: "high"
      enforcement: "block"
      exceptions: ["*.md", "*.txt"]

    - id: "schema-compliance"
      name: "Schema Compliance"
      enabled: true
      scope: "configuration"
      description: "All configuration files must comply with GL schema standards"
      rules:
        - type: "schema_validation"
          required_fields: ["apiVersion", "kind", "metadata", "spec"]
          severity: "critical"
      enforcement: "block"
      exceptions: []

    - id: "naming-convention"
      name: "Naming Convention"
      enabled: true
      scope: "all"
      description: "All files and resources must follow GL naming conventions"
      rules:
        - type: "naming"
          convention: "kebab-case"
          scope: "filenames"
          severity: "high"
        - type: "naming"
          convention: "kebab-case"
          scope: "resource_names"
          severity: "medium"
      enforcement: "warn"
      exceptions: ["README", "LICENSE"]

  semantic_policies:
    - id: "semantic-anchor-required"
      name: "Semantic Anchor Required"
      enabled: true
      scope: "all"
      description: "All files must have a semantic anchor defined"
      rules:
        - type: "semantic_analysis"
          check: "semantic_anchor_present"
          severity: "critical"
      enforcement: "block"

    - id: "intent-resolution-required"
      name: "Intent Resolution Required"
      enabled: true
      scope: "critical"
      description: "Critical files must have intent resolution"
      rules:
        - type: "semantic_analysis"
          check: "intent_resolved"
          severity: "critical"
      enforcement: "block"

    - id: "schema-inference-required"
      name: "Schema Inference Required"
      enabled: true
      scope: "configuration"
      description: "Configuration files must have schema inference"
      rules:
        - type: "semantic_analysis"
          check: "schema_inferred"
          severity: "high"
      enforcement: "warn"

  sharing_policies:
    - id: "semantic-artifact-sharing"
      name: "Semantic Artifact Sharing"
      enabled: true
      scope: "federation"
      description: "Share semantic analysis artifacts across federation"
      rules:
        - type: "artifact_sharing"
          artifact_types: ["semantic-analysis", "classification", "gl-mapping"]
          sharing_mode: "read-only"
          require_trust: "high"
      enforcement: "allow"

    - id: "semantic-event-sharing"
      name: "Semantic Event Sharing"
      enabled: true
      scope: "federation"
      description: "Share semantic analysis events across federation"
      rules:
        - type: "event_sharing"
          event_types: ["semantic-analysis-complete", "semantic-violation-detected", "semantic-fix-applied"]
          sharing_mode: "read-only"
          require_trust: "medium"
      enforcement: "allow"

  validation_policies:
    - id: "semantic-dependency-validation"
      name: "Semantic Dependency Validation"
      enabled: true
      scope: "all"
      description: "Validate semantic dependencies between files"
      rules:
        - type: "dependency_validation"
          validation_mode: "semantic"
          check: "semantic_dependencies_valid"
          severity: "high"
      enforcement: "warn"

    - id: "gl-layer-consistency"
      name: "GL Layer Consistency"
      enabled: true
      scope: "all"
      description: "Ensure GL layers are consistent across dependencies"
      rules:
        - type: "consistency_check"
          check: "gl_layer_consistency"
          severity: "medium"
      enforcement: "warn"

  orchestration_policies:
    - id: "semantic-aware-orchestration"
      name: "Semantic Aware Orchestration"
      enabled: true
      scope: "federation"
      description: "Orchestration must be semantic-aware"
      rules:
        - type: "orchestration"
          requirement: "semantic_graph_required"
          severity: "critical"
        - type: "orchestration"
          requirement: "classification_aware"
          severity: "high"
      enforcement: "block"

    - id: "semantic-auto-repair"
      name: "Semantic Auto-Repair"
      enabled: true
      scope: "high-trust"
      description: "Enable semantic-aware auto-repair for high-trust organizations"
      rules:
        - type: "auto_repair"
          enabled: true
          trust_requirement: "high"
          semantic_aware: true
      enforcement: "allow"

  deployment_policies:
    - id: "semantic-validation-before-deploy"
      name: "Semantic Validation Before Deploy"
      enabled: true
      scope: "all"
      description: "Require semantic validation before deployment"
      rules:
        - type: "pre_deployment"
          requirement: "semantic_validation_passed"
          severity: "critical"
      enforcement: "block"

    - id: "semantic-artifact-signing"
      name: "Semantic Artifact Signing"
      enabled: true
      scope: "federation"
      description: "Sign semantic artifacts before sharing"
      rules:
        - type: "signing"
          artifact_types: ["semantic-analysis", "classification", "gl-mapping"]
          required: true
          algorithm: "ECDSA-P256"
      enforcement: "block"

  policy_profiles:
    - id: "standard"
      name: "Standard Profile"
      policies:
        - "semantic-analysis-required"
        - "governance-tags-required"
        - "schema-compliance"
        - "semantic-anchor-required"
        - "semantic-validation-before-deploy"
      applicable_trust_levels: ["high", "medium"]

    - id: "extended"
      name: "Extended Profile"
      policies:
        - "semantic-analysis-required"
        - "governance-tags-required"
        - "schema-compliance"
        - "naming-convention"
        - "semantic-anchor-required"
        - "intent-resolution-required"
        - "schema-inference-required"
        - "semantic-artifact-sharing"
        - "semantic-event-sharing"
        - "semantic-aware-orchestration"
        - "semantic-auto-repair"
        - "semantic-validation-before-deploy"
        - "semantic-artifact-signing"
      applicable_trust_levels: ["high"]

    - id: "minimal"
      name: "Minimal Profile"
      policies:
        - "governance-tags-required"
        - "schema-compliance"
      applicable_trust_levels: ["medium", "low"]