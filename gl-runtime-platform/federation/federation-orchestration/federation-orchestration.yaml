# @GL-governed
# @GL-layer: governance
# @GL-semantic: federation-orchestration
# @GL-charter-version: 2.0.0
# @GL-audit-trail: ../../engine/governance/GL_SEMANTIC_ANCHOR.json

apiVersion: federation.machinenativeops.io/v1
kind: FederationOrchestration
metadata:
  name: federation-orchestration
  version: "9.0.0"
  created_at: "2026-01-28T00:00:00Z"
  updated_at: "2026-01-30T00:00:00Z"
  created_at: "2026-01-30T00:00:00Z"
  layer: "GL90-99"
  owner: "engineering-team"
  annotations:
    governance.machinenativeops.io/classification: "internal"
    governance.machinenativeops.io/approval: "approved"
    governance.machinenativeops.io/charter-version: "2.0.0"
    governance.machinenativeops.io/semantic-enabled: "true"
    governance.machinenativeops.io/dag-version: "9.0.0"
    governance.machinenativeops.io/global-dag-enabled: "true"

spec:
  mode: "dag-aware-federation"
  semantic_graph_required: true
  semantic_validation_required: true
  global_dag_required: true
  mode: "dag-aware-semantic-federation"
  semantic_graph_required: true
  semantic_validation_required: true
  dag_aware_enabled: true
  dag_version: "9.0.0"

  parallelism:
    max_concurrent_repos: 100
    max_concurrent_agents_per_repo: 8
    timeout_seconds: 3600
    retry_policy:
      max_retries: 3
      backoff_multiplier: 2

  dag_awareness:
    enabled: true
    global_dag_builder:
      enabled: true
      agent: "global-dag-builder"
      scan_interval: 300
      include_external_repos: true
    global_dag_executor:
      enabled: true
      agent: "global-dag-executor"
      parallel_execution: true
      max_parallel_tasks: 100
    cross_repo_resolver:
      enabled: true
      agent: "cross-repo-resolver"
      resolution_strategy: "semantic"
      conflict_resolution: "priority"

  semantic_prerequisites:
    - id: "semantic-graph-build"
      name: "Build Semantic Resource Graph"
      enabled: true
      required: true
      description: "Build SRG before any orchestration"
      priority: 1
    - id: "semantic-validation"
      name: "Semantic Validation"
      enabled: true
      required: true
      description: "Validate semantic consistency"
      priority: 2
    - id: "semantic-compliance-check"
      name: "Semantic Compliance Check"
      enabled: true
      required: true
      description: "Check GL semantic compliance"
      priority: 3

  dag_prerequisites:
    - id: "dag-construction"
      name: "Global DAG Construction"
      enabled: true
      required: true
      description: "Construct global DAG across all repositories"
      priority: 1
    - id: "dag-validation"
      name: "DAG Validation"
      enabled: true
      required: true
      description: "Validate DAG integrity and no cycles"
      priority: 2
    - id: "dag-dependency-resolution"
      name: "DAG Dependency Resolution"
      enabled: true
      required: true
      description: "Resolve cross-repo dependencies in DAG"
      priority: 3
    - id: "dag-optimization"
      name: "DAG Optimization"
      enabled: true
      required: false
      description: "Optimize DAG for parallel execution"
      priority: 4

  per_repo_pipelines:
    - id: "directory-semantic-audit-pipeline"
      name: "Directory Semantic Audit Pipeline"
      enabled: true
      description: "Semantic-aware directory audit"
      stages:
        - id: "semantic-analysis"
          name: "Semantic Analysis"
          agent: "semantic-analyzer"
          enabled: true
          config:
            parse_content: true
            classify_semantics: true
            map_gl_standards: true
            infer_schemas: true
            resolve_intents: true
        - id: "semantic-validation"
          name: "Semantic Validation"
          agent: "semantic-validator"
          enabled: true
          config:
            validate_governance_tags: true
            validate_semantic_anchors: true
            validate_gl_layers: true
            check_compliance: true
        - id: "semantic-reporting"
          name: "Semantic Reporting"
          agent: "semantic-reporter"
          enabled: true
          config:
            generate_semantic_reports: true
            aggregate_findings: true
            create_recommendations: true

    - id: "repo-semantic-fix-pipeline"
      name: "Repository Semantic Fix Pipeline"
      enabled: true
      description: "Semantic-aware fix pipeline"
      stages:
        - id: "semantic-issue-detection"
          name: "Semantic Issue Detection"
          agent: "semantic-issue-detector"
          enabled: true
          config:
            detect_missing_tags: true
            detect_semantic_conflicts: true
            detect_schema_issues: true
        - id: "semantic-fix-generation"
          name: "Semantic Fix Generation"
          agent: "semantic-fix-generator"
          enabled: true
          config:
            generate_governance_tags: true
            generate_semantic_anchors: true
            generate_gl_mappings: true
        - id: "semantic-fix-validation"
          name: "Semantic Fix Validation"
          agent: "semantic-fix-validator"
          enabled: true
          config:
            validate_fixes: true
            ensure_compliance: true
        - id: "semantic-pr-creation"
          name: "Semantic PR/MR Creation"
          agent: "semantic-pr-creator"
          enabled: true
          config:
            create_prs: true
            attach_semantic_artifacts: true
            require_approval: true

  cross_repo_orchestration:
    - id: "federation-semantic-audit"
      name: "Federation Semantic Audit"
      enabled: true
      description: "Cross-repo semantic audit"
      trigger: "scheduled"
      schedule: "0 */6 * * *"
      pipelines:
        - "directory-semantic-audit-pipeline"
      target_repos: "all"
      semantic_aggregation:
        enabled: true
        aggregate_by: "organization"
        generate_federation_report: true

    - id: "federation-semantic-sync"
      name: "Federation Semantic Sync"
      enabled: true
      description: "Synchronize semantic graphs across federation"
      trigger: "event"
      trigger_event: "semantic-graph-updated"
      action: "sync-semantic-graphs"
      target_repos: "all"
      semantic_validation:
        enabled: true
        validate_cross_repo_consistency: true

    - id: "global-dag-execution"
      name: "Global DAG Execution"
      enabled: true
      description: "Execute global DAG across federation"
      trigger: "scheduled"
      schedule: "0 * * * *"
      dag_aware: true
      parallel_execution: true
      target_repos: "all"
      dag_execution:
        build_dag: true
        validate_dag: true
        resolve_dependencies: true
        execute_parallel: true
        synchronization_points: true
        retry_on_failure: true
      reporting:
        generate_dag_execution_report: true
        track_dag_metrics: true
        capture_dag_events: true

    - id: "dag-cross-repo-synchronization"
      name: "DAG Cross-Repo Synchronization"
      enabled: true
      description: "Synchronize DAG execution across repositories"
      trigger: "event"
      trigger_event: "dag-node-completed"
      action: "sync-dag-execution"
      target_repos: "all"
      dag_sync:
        sync_at_synchronization_points: true
        validate_synchronization: true
        timeout_handling: "continue"
        failure_handling: "retry"

  event_aggregation:
    enabled: true
    semantic_events:
      - "semantic-analysis-started"
      - "semantic-analysis-completed"
      - "semantic-validation-started"
      - "semantic-validation-completed"
      - "semantic-violation-detected"
      - "semantic-fix-generated"
      - "semantic-fix-applied"
      - "semantic-pr-created"
      - "semantic-graph-updated"
    aggregation_by:
      - "organization"
      - "repository"
      - "semantic_anchor"
      - "gl_layer"
    retention_hours: 168

  reporting:
    enabled: true
    semantic_reports:
      - id: "federation-semantic-compliance-report"
        name: "Federation Semantic Compliance Report"
        format: "json"
        schedule: "daily"
        include:
          - "semantic_compliance_metrics"
          - "semantic_violation_summary"
          - "semantic_fix_statistics"
          - "cross_repo_semantic_consistency"
      - id: "federation-semantic-health-report"
        name: "Federation Semantic Health Report"
        format: "markdown"
        schedule: "daily"
        include:
          - "semantic_graph_health"
          - "semantic_analysis_performance"
          - "semantic_validation_results"
      - id: "federation-semantic-executive-summary"
        name: "Federation Semantic Executive Summary"
        format: "dashboard"
        schedule: "hourly"
        include:
          - "overall_semantic_compliance"
          - "critical_semantic_issues"
          - "semantic_fix_recommendations"

  semantic_artifact_sharing:
    enabled: true
    share_semantic_analyses: true
    share_semantic_classifications: true
    share_gl_mappings: true
    share_semantic_graphs: true
    trust_requirement: "medium"
    signing_required: true

  semantic_auto_repair:
    enabled: true
    trust_requirement: "high"
    auto_repair_rules:
      - id: "add-missing-governance-tags"
        name: "Add Missing Governance Tags"
        enabled: true
        severity: "auto-fix"
        description: "Automatically add missing governance tags"
        trust_level: "high"
      - id: "add-missing-semantic-anchors"
        name: "Add Missing Semantic Anchors"
        enabled: true
        severity: "auto-fix"
        description: "Automatically add missing semantic anchors"
        trust_level: "high"
      - id: "fix-naming-conventions"
        name: "Fix Naming Conventions"
        enabled: true
        severity: "warn"
        description: "Fix naming convention violations"
        trust_level: "medium"

status:
  phase: "configured"
  semantic_graph_ready: false
  semantic_validation_enabled: true
  conditions:
    - type: "SemanticGraphRequired"
      status: "True"
      message: "Semantic graph is required for all operations"
    - type: "SemanticPipelinesConfigured"
      status: "True"
      message: "Semantic-aware pipelines configured"
    - type: "FederationOrchestrationReady"
      status: "True"
      message: "Federation orchestration ready with semantic awareness"