# @GL-governed
# @GL-layer: GL90-99
# @GL-semantic: federation-repository-topology
# @GL-charter-version: 2.0.0

apiVersion: federation.machinenativeops.io/v1
kind: RepositoryTopology
metadata:
  name: federation-repository-topology
  version: "5.0.0"
  created_at: "2026-01-28T00:00:00Z"
  layer: "GL90-99"
  annotations:
    governance.machinenativeops.io/classification: "internal"
    governance.machinenativeops.io/approval: "approved"

spec:
  repositories:
    - id: "repo-machine-native-ops-main"
      name: "machine-native-ops"
      organization_id: "org-machinenativeops"
      project_id: "proj-machine-native-ops"
      url: "https://github.com/MachineNativeOps/machine-native-ops.git"
      branch: "main"
      type: "monorepo"
      primary_language: "typescript"
      governance_level: "GL90-99"
      trust_level: "high"
      auto_scan: true
      auto_fix: true
      auto_deploy: true
      paths:
        - path: "/"
          components:
            - "gl-runtime-platform"
            - "engine"
            - "file-organizer-system"
            - "elasticsearch-search-system"
            - "instant"
            - "infrastructure"
      dependencies:
        - internal: []
          external: []
      cluster_mappings:
        - cluster_id: "cluster-prod-us-east"
          priority: 1
          namespace: "machine-native-ops-prod"
        - cluster_id: "cluster-staging-us-west"
          priority: 2
          namespace: "machine-native-ops-staging"
      created_at: "2026-01-28T00:00:00Z"

    - id: "repo-enterprise-a-core"
      name: "enterprise-a-core"
      organization_id: "org-enterprise-a"
      project_id: "proj-enterprise-a-core"
      url: "https://github.com/Enterprise-A/core-system.git"
      branch: "main"
      type: "monorepo"
      primary_language: "java"
      governance_level: "GL70-79"
      trust_level: "medium"
      auto_scan: true
      auto_fix: false
      auto_deploy: false
      paths:
        - path: "/"
          components:
            - "core"
            - "services"
            - "api"
      dependencies:
        - internal: []
          external:
            - url: "https://github.com/MachineNativeOps/machine-native-ops.git"
              type: "governance-platform"
      cluster_mappings:
        - cluster_id: "cluster-enterprise-prod"
          priority: 1
          namespace: "enterprise-a-prod"
      created_at: "2026-01-28T00:00:00Z"

  topology_rules:
    - id: "rule-dependency-graph"
      name: "Dependency Graph Validation"
      enabled: true
      description: "Validate dependency graph across repositories"

    - id: "rule-cross-repo-references"
      name: "Cross-Repo Reference Validation"
      enabled: true
      description: "Validate cross-repository references and imports"

    - id: "rule-deployment-order"
      name: "Deployment Order Enforcement"
      enabled: true
      description: "Enforce correct deployment order based on dependencies"

status:
  phase: "active"
  total_repositories: 2
  conditions:
    - type: "RepositoriesMapped"
      status: "True"
    - type: "ClusterMappingsDefined"
      status: "True"
    - type: "DependenciesMapped"
      status: "True"