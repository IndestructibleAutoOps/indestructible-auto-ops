# @GL-governed
# @GL-layer: GL90-99
# @GL-semantic: global-audit-pipeline
# @GL-charter-version: 2.0.0

apiVersion: pipelines.machinenativeops.io/v1
kind: AuditPipeline
metadata:
  name: global-governance-audit
  version: "5.0.0"
  layer: "GL90-99"
  created_at: "2025-01-28T00:00:00Z"
  annotations:
    governance.machinenativeops.io/classification: "internal"
    governance.machinenativeops.io/approval: "approved"

spec:
  # Execution configuration
  execution:
    mode: "per-file-isolated"
    parallelism:
      max_concurrent_files: 10
      max_concurrent_agents: 8
    timeout_seconds: 3600
    retry_policy:
      max_retries: 3
      backoff_multiplier: 2

  # Audit chains
  chains:
    - id: "chain-0"
      name: "multi-agent-parallel-orchestration"
      priority: 1
      enabled: true
      path: ".github/agents/agent-orchestration.yml"
      agents:
        - gl-governance-validator
        - codeql-monitor
        - quality-assurance
        - dependency-scanner
        - architecture-validator
        - security-auditor

    - id: "chain-1"
      name: "prompt-input-validation"
      priority: 2
      enabled: true
      path: "file-organizer-system"
      checks:
        - schema-validation
        - naming-convention
        - governance-tags

    - id: "chain-2"
      name: "governance-layer-validation"
      priority: 3
      enabled: true
      path: ".governance"
      checks:
        - semantic-anchor
        - charter-version
        - layer-compliance

    - id: "chain-3"
      name: "charter-strategy-baseline"
      priority: 4
      enabled: true
      path: "infrastructure"
      checks:
        - strategy-compliance
        - baseline-validation
        - architectural-consistency

    - id: "chain-4"
      name: "agent-hooks-validation"
      priority: 5
      enabled: true
      path: ".agent_hooks"
      checks:
        - hook-integrity
        - governance-validation
        - execution-flow

    - id: "chain-5"
      name: "engine-validation"
      priority: 6
      enabled: true
      path: "engine"
      checks:
        - orchestrator-compliance
        - policy-enforcement
        - event-streaming

    - id: "chain-6"
      name: "esync-platform-validation"
      priority: 7
      enabled: true
      path: "esync-platform"
      checks:
        - event-dispatch
        - task-distribution
        - synchronization

    - id: "chain-7"
      name: "subsystems-validation"
      priority: 8
      enabled: true
      path: "instant"
      checks:
        - search-system
        - file-organizer
        - schema-checkers
        - naming-checkers

    - id: "chain-8"
      name: "data-layer-validation"
      priority: 9
      enabled: true
      path: "summarized_conversations"
      checks:
        - data-integrity
        - semantic-consistency
        - metadata-completeness

  # Validation rules
  validation_rules:
    - name: "gl-semantic-anchor"
      description: "All files must have GL semantic anchor"
      severity: "critical"
      enabled: true

    - name: "governance-tags"
      description: "All files must have governance tags"
      severity: "critical"
      enabled: true

    - name: "naming-convention"
      description: "Files must follow kebab-case naming"
      severity: "warning"
      enabled: true

    - name: "schema-compliance"
      description: "Files must comply with their schemas"
      severity: "critical"
      enabled: true

    - name: "charter-version"
      description: "All files must specify charter version"
      severity: "critical"
      enabled: true

  # Output configuration
  outputs:
    per_file_reports: true
    global_report: true
    event_stream: true
    formats:
      - "json"
      - "yaml"
      - "markdown"

  # Integration points
  integration:
    event_stream:
      enabled: true
      path: "storage/gl-events-stream"
    artifact_store:
      enabled: true
      path: "storage/gl-artifacts"
    git_connector:
      enabled: true
      auto_commit: true
      auto_push: false

status:
  phase: "configured"
  conditions:
    - type: "ChainsConfigured"
      status: "True"
    - type: "ValidationRulesDefined"
      status: "True"
    - type: "IntegrationPointsReady"
      status: "True"