// @GL-governed
// @GL-layer: GL70-89
// @GL-semantic: orchestrator-general-purpose
// @GL-charter-version: 2.0.0
// @GL-audit-trail: ../../engine/governance/GL_SEMANTIC_ANCHOR.json

# @GL-governed
# @GL-layer: GL90-99
# @GL-semantic: auto-bootstrap-configuration
# @GL-audit-trail: ../../../engine/governance/GL_SEMANTIC_ANCHOR.json
#
# GL Unified Charter Activated
# Auto-Orchestrate Configuration

apiVersion: bootstrap.machinenativeops.io/v1
kind: AutoOrchestrateConfiguration
metadata:
  name: gl-auto-orchestrate
  version: "1.0.0"
  created_at: "2026-01-28T00:00:00Z"
  layer: "GL90-99"

spec:
  enabled: true
  orchestration_modes:
    - name: "parallel"
      strategy: "concurrent"
      max_workers: 10
    
    - name: "sequential"
      strategy: "ordered"
      preserve_dependencies: true
    
    - name: "hybrid"
      strategy: "mixed"
      auto_optimize: true

  orchestration_pipelines:
    - id: "audit-repair-validate-pipeline"
      name: "Audit → Repair → Validate Pipeline"
      stages:
        - name: "audit"
          action: "run_scan"
          config:
            scan_type: "full"
            targets: ["gl-markers", "schema", "dependencies"]
        
        - name: "repair"
          action: "auto_repair"
          depends_on: ["audit"]
          config:
            mode: "automatic"
            severity: ["error", "critical"]
        
        - name: "validate"
          action: "run_validation"
          depends_on: ["repair"]
          config:
            pipeline: "strict-validation"
        
        - name: "commit"
          action: "git_commit"
          depends_on: ["validate"]
          config:
            message: "auto: audit-repair-validate pipeline completed"
          condition: "validation_passed"
    
    - id: "integrate-test-deploy-pipeline"
      name: "Integrate → Test → Deploy Pipeline"
      stages:
        - name: "integrate"
          action: "run_integration"
          config:
            integration_points: ["gl-core", "connectors", "pipelines"]
        
        - name: "test"
          action: "run_tests"
          depends_on: ["integrate"]
          config:
            test_suites: ["unit", "integration", "e2e"]
        
        - name: "deploy"
          action: "deploy"
          depends_on: ["test"]
          config:
            environment: "staging"
          condition: "tests_passed"
    
    - id: "scan-validate-report-pipeline"
      name: "Scan → Validate → Report Pipeline"
      stages:
        - name: "scan"
          action: "run_scan"
          config:
            scan_type: "incremental"
            scope: "changed_files"
        
        - name: "validate"
          action: "run_validation"
          depends_on: ["scan"]
          config:
            pipeline: "standard-validation"
        
        - name: "report"
          action: "generate_report"
          depends_on: ["validate"]
          config:
            format: "json"
            destination: "storage/gl-artifacts-store/reports"

  orchestration_triggers:
    - name: "on-violation"
      trigger: "governance_violation"
      pipeline: "audit-repair-validate-pipeline"
      priority: 100
    
    - name: "on-integration-request"
      trigger: "api_call"
      pipeline: "integrate-test-deploy-pipeline"
      priority: 90
    
    - name: "on-schedule"
      trigger: "cron"
      schedule: "0 */4 * * *"
      pipeline: "scan-validate-report-pipeline"
      priority: 80
    
    - name: "on-push"
      trigger: "git_push"
      pipeline: "audit-repair-validate-pipeline"
      priority: 95

  agent_coordination:
    enabled: true
    coordination_mode: "distributed"
    communication:
      type: "event_stream"
      channel: "orchestration-coordination"
    
    agent_roles:
      - name: "orchestrator"
        responsibilities:
          - "coordinate_pipelines"
          - "manage_dependencies"
          - "handle_failures"
        count: 1
      
      - name: "worker"
        responsibilities:
          - "execute_tasks"
          - "report_status"
          - "handle_retries"
        count: 5
      
      - name: "monitor"
        responsibilities:
          - "track_progress"
          - "detect_anomalies"
          - "trigger_alerts"
        count: 2

  error_handling:
    enabled: true
    strategies:
      - name: "retry"
        max_attempts: 3
        backoff: "exponential"
        delay: 1000
      
      - name: "skip"
        on_failure: ["non_critical"]
        continue_pipeline: true
      
      - name: "rollback"
        on_failure: ["critical", "data_loss"]
        action: "rollback_to_previous_state"
      
      - name: "pause"
        on_failure: ["external_dependency"]
        action: "pause_pipeline"
        notify: true

  resource_management:
    enabled: true
    limits:
      cpu: "80%"
      memory: "4GB"
      disk: "10GB"
    
    allocation:
      strategy: "dynamic"
      priority_based: true
    
    cleanup:
      enabled: true
      strategy: "after_completion"
      retain_logs: true
      retain_artifacts: true
      retention_period: "7days"

  notifications:
    enabled: true
    channels:
      - type: "event-stream"
      - type: "log"
      - type: "slack"
        channel: "#gl-orchestration"
    events:
      - "pipeline_started"
      - "pipeline_completed"
      - "pipeline_failed"
      - "pipeline_paused"
      - "stage_started"
      - "stage_completed"
      - "stage_failed"
      - "agent_status_changed"

  monitoring:
    enabled: true
    metrics:
      - "pipelines_executed"
      - "pipelines_succeeded"
      - "pipelines_failed"
      - "stages_executed"
      - "average_pipeline_duration"
      - "agent_utilization"
      - "resource_usage"
    reporting_interval: "minute"

status:
  phase: "active"
  last_orchestration: null
  total_orchestrations: 0
  success_rate: 100
  active_pipelines: 0