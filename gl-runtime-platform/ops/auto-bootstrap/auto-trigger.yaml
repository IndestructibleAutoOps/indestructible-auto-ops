# @GL-governed
# @GL-layer: GL90-99
# @GL-semantic: auto-bootstrap-configuration
# @GL-audit-trail: ../../../engine/governance/GL_SEMANTIC_ANCHOR.json
#
# GL Unified Charter Activated
# Auto-Trigger Configuration

apiVersion: bootstrap.machinenativeops.io/v1
kind: AutoTriggerConfiguration
metadata:
  name: gl-auto-trigger
  version: "1.0.0"
  created_at: "2026-01-28T00:00:00Z"
  layer: "GL90-99"

spec:
  enabled: true
  trigger_modes:
    - name: "file_watch"
      trigger: "file_change"
      debounce: 5000
      batch_size: 50
    
    - name: "schedule"
      trigger: "cron"
      schedule: "*/5 * * * *"
    
    - name: "webhook"
      trigger: "http"
      endpoint: "/api/v1/trigger"
      authentication: "token"
    
    - name: "event_stream"
      trigger: "event"
      event_types:
        - "governance_violation"
        - "schema_change"
        - "dependency_update"

  trigger_rules:
    - id: "on-violation"
      name: "Trigger on Governance Violation"
      event: "governance_violation"
      severity: ["error", "critical"]
      actions:
        - "auto-repair"
        - "notify-team"
      priority: 100
    
    - id: "on-schema-change"
      name: "Trigger on Schema Change"
      event: "schema_change"
      affected_modules: ["governance", "connectors"]
      actions:
        - "validate-schema"
        - "run-integration-tests"
      priority: 90
    
    - id: "on-dependency-update"
      name: "Trigger on Dependency Update"
      event: "dependency_update"
      affected_packages: ["express", "axios", "yaml"]
      actions:
        - "audit-dependencies"
        - "run-tests"
      priority: 85
    
    - id: "on-file-modification"
      name: "Trigger on File Modification"
      event: "file_change"
      file_patterns:
        - "**/*.js"
        - "**/*.py"
        - "**/*.yaml"
        - "**/package.json"
      actions:
        - "validate-gl-markers"
        - "check-naming-convention"
      priority: 80

  trigger_chains:
    - name: "violation-repair-chain"
      triggers:
        - event: "governance_violation"
          severity: "error"
        - event: "auto_repair_completed"
          success: true
      actions:
        - "validate-repair"
        - "run-tests"
        - "commit-changes"
    
    - name: "schema-update-chain"
      triggers:
        - event: "schema_change"
        - event: "validation_passed"
      actions:
        - "update-dependent-modules"
        - "run-integration-tests"
        - "deploy-if-tests-pass"

  conditions:
    - name: "working_hours"
      type: "time"
      schedule: "09:00-18:00"
      timezone: "UTC"
    
    - name: "resource_available"
      type: "system"
      metrics:
        - "cpu_usage < 80%"
        - "memory_usage < 80%"
    
    - name: "no_active_deploys"
      type: "state"
      check: "deployment_in_progress == false"

  rate_limiting:
    enabled: true
    max_triggers_per_minute: 10
    max_triggers_per_hour: 100
    cooldown_period: 60

  notifications:
    enabled: true
    channels:
      - type: "event-stream"
      - type: "log"
      - type: "webhook"
        url: "${TRIGGER_WEBHOOK_URL}"
    events:
      - "trigger_fired"
      - "trigger_skipped"
      - "trigger_failed"
      - "rate_limit_exceeded"

  monitoring:
    enabled: true
    metrics:
      - "triggers_fired"
      - "triggers_skipped"
      - "triggers_failed"
      - "average_trigger_latency"
    reporting_interval: "minute"

status:
  phase: "active"
  last_trigger: null
  total_triggers: 0
  success_rate: 100