# @GL-governed
# @GL-layer: GL90-99
# @GL-semantic: auto-bootstrap-configuration
# @GL-audit-trail: ../../../engine/governance/GL_SEMANTIC_ANCHOR.json
#
# GL Unified Charter Activated
# Auto-Repair Configuration

apiVersion: bootstrap.machinenativeops.io/v1
kind: AutoRepairConfiguration
metadata:
  name: gl-auto-repair
  version: "1.0.0"
  created_at: "2026-01-28T00:00:00Z"
  layer: "GL90-99"

spec:
  enabled: true
  repair_modes:
    - name: "automatic"
      trigger: "violation_detected"
      threshold:
        severity: "error"
        confidence: 90
      auto_apply: true
      require_approval: false
    
    - name: "semi-automatic"
      trigger: "violation_detected"
      threshold:
        severity: "warning"
        confidence: 75
      auto_apply: false
      require_approval: true
    
    - name: "manual"
      trigger: "violation_detected"
      threshold:
        severity: "info"
        confidence: 50
      auto_apply: false
      require_approval: true

  repair_strategies:
    - id: "add-gl-marker"
      name: "Add GL Governed Marker"
      type: "annotation"
      priority: 100
      applies_to:
        - "missing_marker"
      repair_action:
        type: "insert"
        position: "file_start"
        content: |
          # @GL-governed
          # GL-ROOT Global Governance Audit & Platform Build
          # Unified Charter v2.0.0
      languages:
        - "javascript"
        - "python"
        - "yaml"
        - "json"
        - "markdown"
      backup: true

    - id: "add-semantic-anchor"
      name: "Add Semantic Anchor"
      type: "annotation"
      priority: 95
      applies_to:
        - "missing_semantic_anchor"
      repair_action:
        type: "insert"
        position: "after_marker"
        content: |
          # @GL-semantic: module-definition
          # @GL-layer: GL30-60
          # @GL-type: implementation
      languages:
        - "javascript"
        - "python"
        - "yaml"
        - "json"
      backup: true

    - id: "fix-naming-convention"
      name: "Fix Naming Convention"
      type: "transformation"
      priority: 80
      applies_to:
        - "naming_convention_violation"
      repair_action:
        type: "rename"
        strategy: "kebab_case"
        preserve_meaning: true
      languages:
        - "all"
      backup: true
      require_approval: true

    - id: "fix-path-structure"
      name: "Fix Path Structure"
      type: "transformation"
      priority: 75
      applies_to:
        - "path_structure_violation"
      repair_action:
        type: "move"
        strategy: "layer_compliant"
        update_references: true
      languages:
        - "all"
      backup: true
      require_approval: true

    - id: "fix-schema-compliance"
      name: "Fix Schema Compliance"
      type: "validation"
      priority: 90
      applies_to:
        - "schema_violation"
      repair_action:
        type: "modify"
        strategy: "add_required_fields"
        update_references: true
      languages:
        - "yaml"
        - "json"
      backup: false

  validation:
    pre_repair:
      enabled: true
      checks:
        - "file_exists"
        - "file_readable"
        - "backup_available"
    post_repair:
      enabled: true
      checks:
        - "syntax_valid"
        - "no_new_violations"
        - "gl_compliant"
      rollback_on_failure: true

  notifications:
    enabled: true
    channels:
      - type: "event-stream"
      - type: "log"
      - type: "webhook"
        url: "${REPAIR_WEBHOOK_URL}"
    events:
      - "repair_started"
      - "repair_completed"
      - "repair_failed"
      - "repair_rolled_back"

  monitoring:
    enabled: true
    metrics:
      - "repairs_performed"
      - "repairs_failed"
      - "repairs_rolled_back"
      - "average_repair_time"
    reporting_interval: "hourly"

status:
  phase: "active"
  last_repair: null
  total_repairs: 0
  success_rate: 100