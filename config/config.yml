# CI/CD Configuration - Pluggable Architecture
# This file allows enabling/disabling features without modifying workflows

# ============================================
# FEATURE FLAGS - Enable/Disable Features
# ============================================

# Core Features (Always Enabled)
core:
  linting: true
  testing: true
  building: true

# Optional Features (Configurable)
optional:
  # Security Features
  security:
    enabled: true
    sast_scan: true
    dependency_scan: true
    container_scan: false      # Requires Docker
    codeql_analysis: true
    secret_scan: true
  
  # Deployment Features
  deployment:
    enabled: true
    staging: true
    production: true
    blue_green: true           # Requires dual server setup
    
  # Integration Features
  integrations:
    # Cloud Providers
    aws: false                 # Requires AWS credentials
    gcp: false                 # Requires GCP credentials
    azure: false               # Requires Azure credentials
    
    # Container Registry
    docker_registry: false     # Requires registry credentials
    
    # Security Tools
    snyk: false                # Requires Snyk token
    trivy: true                # Built-in, no credentials needed
    
    # Notifications
    slack: false               # Requires Slack webhook
    email: false               # Requires SMTP configuration
    discord: false             # Requires Discord webhook
    
    # Monitoring
    datadog: false             # Requires Datadog API key
    prometheus: false          # Requires Prometheus endpoint
    sentry: false              # Requires Sentry DSN
    
  # Advanced Features
  advanced:
    database_migrations: false # Requires database access
    smoke_tests: true
    acceptance_tests: false
    performance_tests: false
    backup_automation: true

# ============================================
# DEPLOYMENT TARGETS - Configure Where to Deploy
# ============================================

deployment_targets:
  # Local Deployment (Default - No infrastructure required)
  local:
    enabled: true
    type: "local"
    description: "Deploy to local filesystem for testing"
  
  # Self-Hosted Server (Optional - Requires SSH access)
  self_hosted:
    enabled: false
    type: "ssh"
    description: "Deploy to self-hosted server via SSH"
    requires:
      - SSH_PRIVATE_KEY
      - SERVER_HOST
      - SERVER_USER
  
  # Docker (Optional - Requires Docker)
  docker:
    enabled: false
    type: "docker"
    description: "Deploy as Docker container"
    requires:
      - DOCKER_REGISTRY
      - DOCKER_USERNAME
      - DOCKER_PASSWORD
  
  # Kubernetes (Optional - Requires K8s cluster)
  kubernetes:
    enabled: false
    type: "kubernetes"
    description: "Deploy to Kubernetes cluster"
    requires:
      - KUBE_CONFIG
      - KUBE_NAMESPACE
  
  # AWS ECS (Optional - Requires AWS)
  aws_ecs:
    enabled: false
    type: "aws-ecs"
    description: "Deploy to AWS ECS"
    requires:
      - AWS_ACCESS_KEY_ID
      - AWS_SECRET_ACCESS_KEY
      - AWS_REGION
      - ECS_CLUSTER
      - ECS_SERVICE

# ============================================
# ENVIRONMENT CONFIGURATION
# ============================================

environments:
  staging:
    enabled: true
    auto_deploy: true          # Auto-deploy on push to develop
    require_approval: false
    deployment_target: "local"  # Default to local
    
  production:
    enabled: true
    auto_deploy: false         # Manual deployment required
    require_approval: true     # Requires approval before deployment
    deployment_target: "local"  # Default to local
    blue_green: true           # Enable blue-green deployment

# ============================================
# TESTING CONFIGURATION
# ============================================

testing:
  unit_tests:
    enabled: true
    coverage_threshold: 80
  
  integration_tests:
    enabled: true
    requires_external_services: false
  
  e2e_tests:
    enabled: false
    requires_browser: false
  
  smoke_tests:
    enabled: true
    run_after_deployment: true

# ============================================
# ROLLBACK CONFIGURATION
# ============================================

rollback:
  enabled: true
  auto_rollback: true          # Auto-rollback on health check failure
  backup_retention_days: 7
  max_rollback_versions: 5

# ============================================
# NOTIFICATION CONFIGURATION
# ============================================

notifications:
  enabled: false
  channels:
    - type: "console"
      enabled: true
    - type: "slack"
      enabled: false
      webhook: "${{ secrets.SLACK_WEBHOOK }}"
    - type: "email"
      enabled: false
      smtp_server: "${{ secrets.SMTP_SERVER }}"
  
  events:
    on_deployment_start: true
    on_deployment_success: true
    on_deployment_failure: true
    on_rollback: true
    on_security_issue: true