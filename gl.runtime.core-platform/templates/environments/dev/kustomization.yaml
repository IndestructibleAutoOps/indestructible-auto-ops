# @GL-governed
# @GL-layer: GL00-09
# @GL-semantic: general-component
# @GL-audit-trail: gl-enterprise-architecture/governance/audit-trails/GL00_09-audit.json
#
# GL Unified Charter Activated
# GL Root Semantic Anchor: gl-enterprise-architecture/governance/GL-ROOT-SEMANTIC-ANCHOR.yaml
# GL Unified Naming Charter: gl-enterprise-architecture/governance/GL-UNIFIED-NAMING-CHARTER.yaml


# GL Runtime Platform 開發環境 Kustomization 配置

apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: gl-runtime-dev

namespace: team-gl-runtime-dev-us-west

resources:
  - ../../base/namespace/namespace-dev.yaml
  - ../../base/deployments/deployment-platform-api.yaml
  - ../../base/deployments/deployment-rest-api.yaml
  - ../../base/deployments/deployment-nlp-control-plane.yaml
  - ../../base/deployments/deployment-postgres.yaml
  - ../../base/services/service-platform-api.yaml
  - ../../base/services/service-rest-api.yaml
  - ../../base/services/service-nlp-control-plane.yaml
  - ../../base/services/service-postgres.yaml
  - ../../base/configmaps/configmap-platform-api.yaml
  - ../../base/configmaps/configmap-rest-api.yaml
  - ../../base/configmaps/configmap-postgres.yaml
  - ../../base/secrets/secret-postgres.yaml
  - ../../base/rbac/serviceaccount-platform-api.yaml
  - ../../base/rbac/serviceaccount-rest-api.yaml
  - ../../base/rbac/serviceaccount-nlp-control-plane.yaml

# 環境特定標籤
commonLabels:
  environment: development
  tier: dev
  cost-center: platform-engineering

# 環境特定註解
commonAnnotations:
  environment.config: development
  backup.policy: disabled
  monitoring.tier: low
  documentation: https://docs.gl-runtime.io/environments/development

# 資源名稱轉換
namePrefix: dev-

# 資源命名空間覆蓋
namespace: team-gl-runtime-dev-us-west

# 副本數覆蓋
replicas:
  - name: dev-gl-execution-runtime-api-deploy-v1
    count: 1
  - name: dev-gl-runtime-rest-api-deploy-v1
    count: 1
  - name: dev-gl-runtime-nlp-control-plane-deploy-v1
    count: 1
  - name: dev-gl-runtime-postgres-deploy-v1
    count: 1

# 映像標籤覆蓋
images:
  - name: gl-registry.io/gl-execution-runtime/api
    newTag: v1.0.0-dev
  - name: gl-registry.io/gl-execution-runtime/rest-api
    newTag: v1.0.0-dev
  - name: gl-registry.io/gl-execution-runtime/nlp-control-plane
    newTag: v1.0.0-dev
  - name: postgres
    newTag: 15-alpine

# 配置補丁
patchesStrategicMerge:
  - patches/deployment-patch.yaml
  - patches/configmap-patch.yaml

# 生成器
configMapGenerator:
  - name: dev-config
    literals:
      - ENV=development
      - LOG_LEVEL=debug
      - DEBUG=true
      - GOVERNANCE_LEVEL=DEVELOPMENT

secretGenerator:
  - name: dev-secrets
    literals:
      - DATABASE_PASSWORD=dev_password_change_me
      - API_KEY=dev_api_key_change_me
    type: Opaque

# 資源配置
configurations:
  - kustomizeconfig.yaml