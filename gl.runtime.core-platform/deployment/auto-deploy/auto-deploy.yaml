// @GL-governed
// @GL-layer: GL70-89
// @GL-semantic: runtime-deployment
// @GL-charter-version: 2.0.0
// @GL-audit-trail: ../../engine/governance/GL_SEMANTIC_ANCHOR.json

# @GL-governed
# @GL-layer: GL90-99
# @GL-semantic: auto-deploy-configuration
# @GL-audit-trail: ../../../engine/governance/GL_SEMANTIC_ANCHOR.json
#
# GL Unified Charter Activated
# Version 3: Auto-Deploy Layer (Deployment Automation)

apiVersion: gl.machinenativeops.io/v1
kind: AutoDeploy
metadata:
  name: gl-runtime-autodeploy
  version: "1.0.0"
  created_at: "2026-01-28T00:00:00Z"
  layer: "GL90-99"
  annotations:
    governance.machinenativeops.io/classification: "internal"
    governance.machinenativeops.io/approval: "approved"
    governance.machinenativeops.io/charter-version: "2.0.0"

spec:
  enable: true
  target: "k8s"
  
  overlays:
    - path: "deployment/k8s/overlays/dev"
      environment: "dev"
      enabled: true
    - path: "deployment/k8s/overlays/staging"
      environment: "staging"
      enabled: true
    - path: "deployment/k8s/overlays/prod"
      environment: "prod"
      enabled: true
  
  triggers:
    - type: "pipeline.completed"
      source: "ops/pipelines"
      filter:
        status: "success"
    - type: "agent-orchestration.updated"
      source: ".github/agents"
      filter:
        version: ">=1.0.0"
    - type: "gl-governance-validator.passed"
      source: "governance"
      filter:
        compliance: "100"
    - type: "manual"
      source: "api"
      endpoint: "/api/v1/deploy/trigger"
  
  deployment_strategy:
    type: "rolling"
    max_surge: 1
    max_unavailable: 0
    timeout_seconds: 300
    
  pre_deployment:
    - validate_kubectl_context
    - check_resource_limits
    - backup_current_deployment
    
  post_deployment:
    - verify_health_status
    - run_smoke_tests
    - generate_deployment_report
    
  monitoring:
    enabled: true
    metrics_port: 9090
    health_check_interval_seconds: 30
    log_level: "info"
    
  rollback:
    enabled: true
    trigger_on:
      - "health_check_failure"
      - "deployment_timeout"
      - "manual_rollback"
    
status:
  phase: "ready"
  last_deployment: null
  deployment_count: 0
  conditions:
    - type: "AutoDeployConfigured"
      status: "True"
      lastTransitionTime: "2026-01-28T00:00:00Z"
      reason: "Auto-deploy configuration loaded"
    - type: "K8sContextValidated"
      status: "True"
      lastTransitionTime: "2026-01-28T00:00:00Z"
      reason: "Kubernetes context validated"