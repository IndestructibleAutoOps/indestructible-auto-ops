// @GL-governed
// @GL-layer: GL70-89
// @GL-semantic: runtime-scanning
// @GL-charter-version: 2.0.0
// @GL-audit-trail: ../../engine/governance/GL_SEMANTIC_ANCHOR.json

# @GL-governed
# @GL-layer: GL90-99
# @GL-semantic: auto-bootstrap-configuration
# @GL-audit-trail: ../../../engine/governance/GL_SEMANTIC_ANCHOR.json
#
# GL Unified Charter Activated
# Auto-Scan Configuration

apiVersion: bootstrap.machinenativeops.io/v1
kind: AutoScanConfiguration
metadata:
  name: gl-auto-scan
  version: "1.0.0"
  created_at: "2026-01-28T00:00:00Z"
  layer: "GL90-99"

spec:
  enabled: true
  scan_modes:
    - name: "incremental"
      trigger: "file_change"
      scope: "changed_files"
    
    - name: "full"
      trigger: "schedule"
      schedule: "0 2 * * *"
      scope: "entire_workspace"
    
    - name: "targeted"
      trigger: "api_call"
      scope: "specified_paths"
    
    - name: "continuous"
      trigger: "background"
      interval: 3600
      scope: "entire_workspace"

  scan_targets:
    - id: "gl-markers-scan"
      name: "GL Markers Scan"
      type: "annotation"
      priority: 100
      config:
        search_patterns:
          - "@GL-governed"
          - "@GL-layer"
          - "@GL-semantic"
          - "@GL-audit-trail"
        validate:
          - "marker_present"
          - "layer_valid"
          - "semantic_anchor_exists"
        report_missing: true
    
    - id: "schema-validation-scan"
      name: "Schema Validation Scan"
      type: "validation"
      priority: 95
      config:
        schemas:
          - path: "engine/governance/GL_SEMANTIC_ANCHOR.json"
          - path: "ops/pipelines/*.yaml"
          - path: "ops/auto-bootstrap/*.yaml"
        validate:
          - "syntax_valid"
          - "required_fields_present"
          - "type_correctness"
    
    - id: "dependency-scan"
      name: "Dependency Scan"
      type: "security"
      priority: 90
      config:
        package_files:
          - "package.json"
          - "requirements.txt"
          - "go.mod"
        check:
          - "known_vulnerabilities"
          - "outdated_versions"
          - "license_compliance"
    
    - id: "naming-convention-scan"
      name: "Naming Convention Scan"
      type: "style"
      priority: 85
      config:
        conventions:
          - target: "files"
            pattern: "kebab-case"
            extensions: ["yaml", "json"]
          - target: "directories"
            pattern: "kebab-case"
          - target: "javascript_classes"
            pattern: "PascalCase"
          - target: "javascript_functions"
            pattern: "camelCase"
          - target: "python_classes"
            pattern: "PascalCase"
          - target: "python_functions"
            pattern: "snake_case"
    
    - id: "path-structure-scan"
      name: "Path Structure Scan"
      type: "architecture"
      priority: 80
      config:
        validate:
          - "layer_compliance"
          - "module_boundaries"
          - "circular_dependencies"
        rules:
          - "engine/* must not depend on ops/*"
          - "governance/* must not depend on connectors/*"
          - "connectors/* must be independent"

  scan_actions:
    - id: "report-violations"
      name: "Report Violations"
      action: "log"
      config:
        format: "json"
        destination: "storage/gl-artifacts-store/scan-reports"
    
    - id: "auto-fix-minor"
      name: "Auto-Fix Minor Issues"
      action: "repair"
      config:
        severity: ["info", "warning"]
        require_approval: false
        backup: true
    
    - id: "flag-critical"
      name: "Flag Critical Issues"
      action: "notify"
      config:
        severity: ["error", "critical"]
        channels:
          - "event-stream"
          - "slack"
    
    - id: "create-ticket"
      name: "Create Tickets"
      action: "integration"
      config:
        platform: "github"
        auto_create: true
        template: "scan-violation-template"

  exclusions:
    - path: "node_modules/**"
      reason: "Third-party dependencies"
    - path: ".git/**"
      reason: "Git metadata"
    - path: "archives/**"
      reason: "Archived files"
    - path: "outputs/**"
      reason: "Generated outputs"
    - path: "*.log"
      reason: "Log files"

  parallel_scan:
    enabled: true
    max_parallel_scans: 5
    resource_limits:
      cpu: "50%"
      memory: "2GB"

  notifications:
    enabled: true
    channels:
      - type: "event-stream"
      - type: "log"
      - type: "webhook"
        url: "${SCAN_WEBHOOK_URL}"
    events:
      - "scan_started"
      - "scan_completed"
      - "scan_failed"
      - "violations_found"

  monitoring:
    enabled: true
    metrics:
      - "scans_completed"
      - "scans_failed"
      - "violations_found"
      - "violations_fixed"
      - "average_scan_time"
    reporting_interval: "hourly"

status:
  phase: "active"
  last_scan: null
  total_scans: 0
  violations_found: 0
  violations_fixed: 0