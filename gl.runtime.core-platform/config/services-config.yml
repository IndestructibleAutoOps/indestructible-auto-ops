# @GL-governed
# @GL-layer: GL10-29 Operational
# @GL-semantic: services-configuration
# @GL-charter-version: 1.0.0
#
# GL Runtime Platform 服務配置

services:
  # GL Runtime Platform 主服務
  gl_runtime_platform:
    enabled: true
    port: 3000
    process_type: "node"
    startup_command: "node simple-server.js"
    health_check_endpoint: "/health"
    dependencies: []
    environment:
      NODE_ENV: "production"
      GL_VERSION: "8.0.0"
      GOVERNANCE_CHARTER: "ACTIVATED"

  # REST API 服務
  rest_api:
    enabled: true
    port: 8080
    process_type: "python"
    startup_command: "python3 /tmp/rest_api_server.py"
    health_check_endpoint: "/health"
    dependencies: []
    environment:
      PYTHONUNBUFFERED: "1"
      LOG_LEVEL: "INFO"

  # 自然語言控制平面
  nlp_control_plane:
    enabled: true
    port: 5001
    process_type: "python"
    startup_command: "python3 control-plane/nlp-control-api.py"
    health_check_endpoint: "/health"
    dependencies: ["redis"]
    environment:
      PYTHONUNBUFFERED: "1"
      FLASK_ENV: "production"
      REDIS_HOST: "localhost"
      REDIS_PORT: "6379"

  # PostgreSQL 資料庫
  postgres:
    enabled: true
    port: 5432
    process_type: "system"
    startup_command: "service postgresql start"
    health_check_command: "pg_isready -h localhost -p 5432"
    dependencies: []
    environment:
      POSTGRES_DB: "gl_governance"
      POSTGRES_USER: "gladmin"
      POSTGRES_PASSWORD: "gladmin123"

  # Redis 事件流
  redis:
    enabled: true
    port: 6379
    process_type: "system"
    startup_command: "redis-server --daemonize yes --port 6379 --dir /tmp/redis --appendonly yes"
    health_check_command: "redis-cli ping"
    dependencies: []
    environment:
      REDIS_DIR: "/tmp/redis"
      REDIS_APPENDONLY: "yes"

  # MinIO 物件存儲
  minio:
    enabled: true
    ports: [9000, 9001]
    process_type: "python"
    startup_command: "python3 /tmp/minio_mock.py"
    health_check_endpoint: "/health"
    dependencies: []
    environment:
      MINIO_ROOT_USER: "gladmin"
      MINIO_ROOT_PASSWORD: "gladmin123"

  # Prometheus 監控
  prometheus:
    enabled: true
    port: 9090
    process_type: "python"
    startup_command: "python3 /tmp/prometheus_mock.py"
    health_check_endpoint: "/health"
    dependencies: []
    environment:
      PROMETHEUS_RETENTION: "30d"

  # 健康檢查服務
  health_check_1:
    enabled: true
    port: 3001
    process_type: "python"
    startup_command: "python3 /tmp/health_check_1.py"
    health_check_endpoint: "/health"
    dependencies: []

  health_check_2:
    enabled: true
    port: 3002
    process_type: "python"
    startup_command: "python3 /tmp/health_check_2.py"
    health_check_endpoint: "/health"
    dependencies: []

# 子系統配置
subsystems:
  api_rest:
    enabled: true
    priority: 1
    load_on_startup: true

  engine:
    enabled: true
    priority: 1
    load_on_startup: true

  gl_runtime:
    enabled: true
    priority: 1
    load_on_startup: true

  cognitive_mesh:
    enabled: true
    priority: 2
    load_on_startup: true

  meta_cognition:
    enabled: true
    priority: 2
    load_on_startup: true

  meta_cognitive:
    enabled: true
    priority: 2
    load_on_startup: true

  unified_intelligence_fabric:
    enabled: true
    priority: 2
    load_on_startup: true

  ultra_strict_verification_core:
    enabled: true
    priority: 1
    load_on_startup: true

  governance:
    enabled: true
    priority: 1
    load_on_startup: true

  infinite_learning_continuum:
    enabled: true
    priority: 3
    load_on_startup: true

  trans_domain:
    enabled: true
    priority: 3
    load_on_startup: true

  inter_reality:
    enabled: true
    priority: 3
    load_on_startup: true

  civilization:
    enabled: true
    priority: 3
    load_on_startup: true

  ops:
    enabled: true
    priority: 2
    load_on_startup: true

  connectors:
    enabled: true
    priority: 2
    load_on_startup: true

  deployment:
    enabled: true
    priority: 2
    load_on_startup: true

  fabric_storage:
    enabled: true
    priority: 2
    load_on_startup: true

  federation:
    enabled: true
    priority: 3
    load_on_startup: true

  storage:
    enabled: true
    priority: 2
    load_on_startup: true

  reports_main:
    enabled: true
    priority: 3
    load_on_startup: true

  governance_audit_reports:
    enabled: true
    priority: 3
    load_on_startup: true

# 服務依賴關係
dependency_graph:
  gl_runtime_platform: []
  rest_api: []
  nlp_control_plane: ["redis"]
  postgres: []
  redis: []
  minio: []
  prometheus: []
  health_check_1: ["gl_runtime_platform"]
  health_check_2: ["gl_runtime_platform"]

# 啟動順序
startup_order:
  phase_1:
    - postgres
    - redis
  phase_2:
    - gl_runtime_platform
    - rest_api
    - nlp_control_plane
  phase_3:
    - minio
    - prometheus
  phase_4:
    - health_check_1
    - health_check_2