# Development Platform Instance - Deployment Configuration
# Semantic Anchor: CLOUDPLATFORMINSTANCE.DEV.DEPLOYMENT

deployment:
  strategy: rolling
  semantic_anchor: CLOUDPLATFORMINSTANCE.DEV.STRATEGY
  
  health_check:
    enabled: true
    path: /health
    interval_seconds: 30
    timeout_seconds: 10
    healthy_threshold: 2
    unhealthy_threshold: 3
    grace_period_seconds: 60
  
  rolling_update:
    max_surge_percent: 100
    max_unavailable_percent: 0
    min_healthy_percent: 50
  
  rollback:
    enabled: true
    on_health_check_failure: true
    on_deployment_failure: true
    timeout_seconds: 1800
    automatic_rollback_enabled: true

pipeline:
  stages:
    - name: validate
      enabled: true
      steps:
        - name: validate_configuration
          tool: ecosystem/tools/validate_platform.py
          timeout_seconds: 60
        
        - name: validate_contracts
          tool: ecosystem/tools/validate_contracts.py
          timeout_seconds: 60
        
        - name: security_scan
          tool: ecosystem/tools/security_scan.py
          timeout_seconds: 120
    
    - name: build
      enabled: true
      steps:
        - name: build_images
          tool: ecosystem/tools/build_images.py
          timeout_seconds: 600
        
        - name: push_images
          tool: ecosystem/tools/push_images.py
          timeout_seconds: 300
    
    - name: deploy_infrastructure
      enabled: true
      steps:
        - name: deploy_networking
          tool: ecosystem/tools/deploy_networking.py
          timeout_seconds: 300
        
        - name: deploy_storage
          tool: ecosystem/tools/deploy_storage.py
          timeout_seconds: 180
        
        - name: deploy_queues
          tool: ecosystem/tools/deploy_queues.py
          timeout_seconds: 180
        
        - name: deploy_databases
          tool: ecosystem/tools/deploy_databases.py
          timeout_seconds: 600
    
    - name: deploy_services
      enabled: true
      steps:
        - name: deploy_api_gateway
          tool: ecosystem/tools/deploy_service.py
          service: api_gateway
          timeout_seconds: 300
        
        - name: deploy_data_processing
          tool: ecosystem/tools/deploy_service.py
          service: data_processing
          timeout_seconds: 300
        
        - name: deploy_observability
          tool: ecosystem/tools/deploy_service.py
          service: observability
          timeout_seconds: 300
        
        - name: deploy_integration_hub
          tool: ecosystem/tools/deploy_service.py
          service: integration_hub
          timeout_seconds: 300
    
    - name: verify
      enabled: true
      steps:
        - name: health_check
          tool: ecosystem/tools/health_check.py
          timeout_seconds: 120
        
        - name: smoke_test
          tool: ecosystem/tools/smoke_test.py
          timeout_seconds: 180
        
        - name: integration_test
          tool: ecosystem/tools/integration_test.py
          timeout_seconds: 300

notifications:
  slack:
    enabled: true
    webhook_url: ${SLACK_DEV_WEBHOOK_URL}
    channels:
      deployment: dev-deployments
      alerts: dev-alerts
    notify_on:
      - deployment_started
      - deployment_succeeded
      - deployment_failed
      - rollback_triggered
      - health_check_failed
  
  email:
    enabled: true
    recipients:
      - dev-team@machine-native-ops
      - platform-team@machine-native-ops
    notify_on:
      - deployment_failed
      - rollback_triggered
      - health_check_failed

drift_detection:
  enabled: true
  check_interval_minutes: 30
  
  checks:
    - name: configuration_drift
      enabled: true
      severity: HIGH
      auto_remediate: false
    
    - name: adapter_drift
      enabled: true
      severity: MEDIUM
      auto_remediate: false
    
    - name: contract_drift
      enabled: true
      severity: CRITICAL
      auto_remediate: false

compliance:
  enabled: true
  checks:
    - name: governance_compliance
      enabled: true
      tool: ecosystem/enforce.py
      severity: CRITICAL
      block_deployment: true
    
    - name: security_compliance
      enabled: true
      tool: ecosystem/tools/security_compliance.py
      severity: HIGH
      block_deployment: true
    
    - name: cost_compliance
      enabled: true
      tool: ecosystem/tools/cost_compliance.py
      severity: MEDIUM
      block_deployment: false

monitoring:
  post_deployment:
    enabled: true
    duration_minutes: 30
    
    metrics:
      - name: error_rate
        threshold_percent: 5
      
      - name: latency_p95
        threshold_ms: 1000
      
      - name: cpu_utilization
        threshold_percent: 80
      
      - name: memory_utilization
        threshold_percent: 85
    
    actions_on_failure:
      - type: alert
        channel: slack
      - type: rollback
        auto: false

version_control:
  track_changes: true
  store_deployment_artifacts: true
  artifact_retention_days: 30
  
  required_metadata:
    - git_commit_hash
    - git_branch
    - author
    - timestamp
    - config_version
    - contract_version
    - adapter_version

rollback_strategy:
  automatic: true
  conditions:
    - health_check_failed: true
    - deployment_failed: true
    - post_deployment_checks_failed: true
  
  manual:
    enabled: true
    require_approval: false
  
  retention:
    previous_versions: 3
    keep_successful_deployments: true

scaling:
  initial_scale:
    api_gateway: 1
    data_processing: 1
    observability: 1
    integration_hub: 1
  
  post_deployment_scale:
    enabled: false
  
  warmup:
    enabled: false
    duration_seconds: 0