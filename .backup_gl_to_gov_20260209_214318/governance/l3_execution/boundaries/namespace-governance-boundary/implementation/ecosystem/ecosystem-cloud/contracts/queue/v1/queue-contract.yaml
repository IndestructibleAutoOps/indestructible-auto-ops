# Cross-Cloud Queue Contract v1.0.0
# Semantic Anchor: CLOUDPROVIDERABSTRACTION.QUEUE

contract:
  name: CrossCloudQueue
  version: 1.0.0
  semantic_anchor: CLOUDPROVIDERABSTRACTION.QUEUE
  description: |
    Unified abstraction for cloud message queue services across all providers.
    Defines the contract that all cloud adapters must implement for queue operations.
  
  capability:
    - name: create_queue
      input:
        queue_name: string (required)
        visibility_timeout_seconds: integer (optional, default: 30)
        message_retention_seconds: integer (optional, default: 345600)
        max_message_size_bytes: integer (optional, default: 262144)
        delivery_delay_seconds: integer (optional, default: 0)
        dead_letter_queue: string (optional)
        tags: map[string]string (optional)
      output:
        success: boolean
        queue_url: string
        queue_arn: string
    
    - name: delete_queue
      input:
        queue_url: string (required)
      output:
        success: boolean
    
    - name: send_message
      input:
        queue_url: string (required)
        message_body: string (required)
        message_attributes: map[string]MessageAttribute (optional)
        delay_seconds: integer (optional, default: 0)
      output:
        success: boolean
        message_id: string
        md5_of_body: string
    
    - name: receive_message
      input:
        queue_url: string (required)
        max_number_of_messages: integer (optional, default: 1)
        wait_time_seconds: integer (optional, default: 0)
        visibility_timeout_seconds: integer (optional)
        message_attribute_names: list[string] (optional)
      output:
        success: boolean
        messages: list[Message]
    
    - name: delete_message
      input:
        queue_url: string (required)
        receipt_handle: string (required)
      output:
        success: boolean
    
    - name: purge_queue
      input:
        queue_url: string (required)
      output:
        success: boolean
    
    - name: get_queue_attributes
      input:
        queue_url: string (required)
        attribute_names: list[string] (optional)
      output:
        success: boolean
        attributes: map[string]string

  types:
    Message:
      message_id: string
      receipt_handle: string
      body: string
      md5_of_body: string
      attributes: map[string]string
      message_attributes: map[string]MessageAttribute
    
    MessageAttribute:
      data_type: string
      string_value: string (optional)
      binary_value: binary (optional)
      string_list_values: list[string] (optional)
      binary_list_values: list[binary] (optional)
  
  validation:
    - name: queue_name_validation
      rule: |
        Queue names must:
        - Be 1-80 characters long
        - Contain only alphanumeric, hyphens, and underscores
        - Not contain consecutive periods
      severity: CRITICAL
    
    - name: message_size_validation
      rule: |
        Message body must not exceed 256KB
      severity: HIGH
    
    - name: visibility_timeout_validation
      rule: |
        Visibility timeout must be between 0 and 43200 seconds (12 hours)
      severity: MEDIUM
    
    - name: retention_period_validation
      rule: |
        Message retention must be between 60 and 1209600 seconds (14 days)
      severity: MEDIUM

  adapter_requirements:
    - Adapter must implement all capability methods
    - Adapter must handle message delivery guarantees (at-least-once)
    - Adapter must support visibility timeout and retry logic
    - Adapter must support dead letter queues
    - Adapter must handle provider-specific message formats
    - Adapter must provide metrics for queue operations
  
  compatibility:
    aws_sqs:
      implements: full
      notes: AWS SQS is the reference implementation
    azure_service_bus:
      implements: partial
      notes: Features may vary, needs mapping
    gcp_pubsub:
      implements: partial
      notes: Different model (topic-based), needs adapter
    rabbitmq:
      implements: full
      notes: Full support, popular on-premise option