# @GL-semantic: org.mnga.ugs.index@1.0.0
# @GL-audit-trail: enabled
# UGS Layer 03: Index Specification
# Defines indexing and lookup mechanisms for governance specifications

spec_id: org.mnga.ugs.index@1.0.0
spec_type: index-spec
layer: L03
immutable: true

metadata:
  name: UGS Index Layer
  version: 1.0.0
  created_at: 2024-02-03T14:00:00Z
  updated_at: 2024-02-03T14:00:00Z
  author: MNGA Governance Team
  description: |
    Defines indexing and lookup mechanisms for all governance
    specifications. Provides fast lookup by spec_id, semantic
    anchor, layer, and other attributes.

index_structure:
  # Primary index by spec_id
  primary_index:
    name: spec_id_index
    type: hash
    key_field: spec_id
    unique: true
    description: Primary lookup by specification ID
    fields:
      - spec_id
      - spec_type
      - layer
      - version
      - status

  # Secondary indexes
  secondary_indexes:
    - name: semantic_anchor_index
      type: hash
      key_field: semantic_anchor
      unique: false
      description: Lookup by semantic anchor
      fields:
        - semantic_anchor
        - spec_id
        - spec_type
    
    - name: layer_index
      type: range
      key_field: layer
      unique: false
      description: Lookup by layer (L00-L99)
      fields:
        - layer
        - spec_id
        - spec_type
    
    - name: spec_type_index
      type: hash
      key_field: spec_type
      unique: false
      description: Lookup by specification type
      fields:
        - spec_type
        - spec_id
        - layer
    
    - name: status_index
      type: hash
      key_field: status
      unique: false
      description: Lookup by status
      fields:
        - status
        - spec_id
        - layer
    
    - name: dependency_index
      type: graph
      key_field: dependencies
      unique: false
      description: Lookup by dependencies
      fields:
        - spec_id
        - dependencies
        - dependents

index_operations:
  # CRUD operations
  create:
    operation: insert
    description: Add new specification to index
    required_fields:
      - spec_id
      - spec_type
      - layer
      - version
    indexes:
      - spec_id_index
      - semantic_anchor_index
      - layer_index
      - spec_type_index
      - status_index
  
  read:
    operation: query
    description: Query specifications from index
    supported_queries:
      - by_spec_id
      - by_semantic_anchor
      - by_layer
      - by_spec_type
      - by_status
      - by_dependencies
  
  update:
    operation: update
    description: Update specification in index
    required_fields:
      - spec_id
    updatable_fields:
      - version
      - status
      - dependencies
      - checksum
  
  delete:
    operation: delete
    description: |
      Remove specification from index and all associated indexes
    required_fields:
      - spec_id
    cascade: true

index_maintenance:
  # Reindexing
  reindex:
    operation: rebuild
    description: Rebuild all indexes from source
    triggers:
      - manual
      - scheduled
    frequency: daily
    retention: 7 days
  
  # Cleanup
  cleanup:
    operation: remove_stale
    description: Remove stale entries from index
    triggers:
      - manual
      - scheduled
    frequency: hourly
    stale_threshold: 24 hours
  
  # Validation
  validation:
    operation: verify_integrity
    description: Verify index integrity
    triggers:
      - manual
      - scheduled
    frequency: daily
    checks:
      - duplicate_keys
      - orphaned_entries
      - broken_references

index_performance:
  # Performance targets
  targets:
    - metric: query_latency
      target: < 10ms
      description: Query latency for single lookup
    
    - metric: insert_latency
      target: < 50ms
      description: Insert latency for new specification
    
    - metric: update_latency
      target: < 30ms
      description: Update latency for existing specification
    
    - metric: index_size
      target: < 100MB
      description: Total index size for 1000 specifications

  # Optimization
  optimization:
    - technique: caching
      description: Cache frequently accessed entries
      ttl: 3600 seconds
    
    - technique: compression
      description: Compress index data
      algorithm: gzip
    
    - technique: sharding
      description: Shard index by layer
      shard_key: layer

index_security:
  # Access control
  access_control:
    read:
      roles:
        - ecosystem.analyst
        - ecosystem.validator
        - ecosystem.semantic-checker
        - ecosystem.architect
        - ecosystem.runner
      description: Read access to index
    
    write:
      roles:
        - ecosystem.architect
        - ecosystem.validator
      description: Write access to index
    
    delete:
      roles:
        - ecosystem.architect
      description: Delete access to index

  # Audit logging
  audit:
    enabled: true
    log_operations:
      - create
      - update
      - delete
    log_fields:
      - actor
      - operation
      - spec_id
      - timestamp
      - result

audit_trail:
  created_at: 2024-02-03T14:00:00Z
  created_by: MNGA Governance Team
  version: 1.0.0
  checksum: sha256:pending
  changes:
    - version: 1.0.0
      date: 2024-02-03T14:00:00Z
      author: MNGA Governance Team
      description: Initial version of UGS index layer