#
# @GL-governed
# @GL-layer: GL90-99
# @GL-semantic: governance
# @GL-audit-trail: ../../governance/GL_SEMANTIC_ANCHOR.json
#
apiVersion: gov-evolution/v1
kind: FlowUpgradeLog
metadata:
  upgradeId: "{{ auto_generated_uuid }}"
  triggerExecution: "{{ execution_id }}"
  upgradeTimestamp: "{{ iso8601_timestamp }}"
  upgradeType: "{{ automated|manual|hybrid }}"
  evolutionaryPhase: "{{ discovery|optimization|transformation }}"
  version: "1.0.0"

spec:
  upgradeContext:
    triggeredBy:
      type: "{{ analysis|delta|manual|anomaly }}"
      source: "{{ gl.execution.analysis-report.yaml|gl.execution.delta-report.yaml|manual-request }}"
      reason: "{{ detailed_trigger_reason }}"
      evidence: "{{ evidence_path }}"
    
    preUpgradeState:
      processVersion: "{{ previous_version }}"
      maturityScore: "{{ score }}"
      knownLimitations: "{{ limitations }}"
      technicalDebt: "{{ debt_score }}"
      evidence: "{{ evidence_path }}"
    
    upgradeGoals:
      primaryGoal: "{{ main_objective }}"
      secondaryGoals:
        - "{{ goal1 }}"
        - "{{ goal2 }}"
      successCriteria:
        - metric: "{{ metric_name }}"
          target: "{{ target_value }}"
          weight: "{{ weight }}"
        - metric: "{{ metric_name }}"
          target: "{{ target_value }}"
          weight: "{{ weight }}"

  upgradeOperations:
    contractUpgrades:
      - contract: "{{ contract_path }}"
        operation: "{{ create|update|deprecate|delete }}"
        changeType: "{{ breaking|non-breaking|enhancement }}"
        changes:
          - field: "{{ field_name }}"
            from: "{{ old_value }}"
            to: "{{ new_value }}"
            reason: "{{ change_rationale }}"
            evidence: "{{ evidence_path }}"
        validation:
          preUpgrade: "{{ validation_result }}"
          postUpgrade: "{{ validation_result }}"
        impact: "{{ breaking|non-breaking|enhancement }}"
        rollbackPlan: "{{ plan_description }}"
    
    validationRuleUpgrades:
      - rule: "{{ rule_name }}"
        operation: "{{ add|modify|remove }}"
        changeDescription: "{{ what_changed }}"
        triggerCondition: "{{ when_applies }}"
        impact: "{{ low|medium|high }}"
        testCases:
          - scenario: "{{ test_scenario }}"
            expected: "{{ expected_result }}"
            actual: "{{ actual_result }}"
            evidence: "{{ evidence_path }}"
        evidence: "{{ evidence_path }}"
    
    pipelineUpgrades:
      - pipeline: "{{ pipeline_name }}"
        phase: "{{ phase_name }}"
        upgrades:
          - component: "{{ component_name }}"
            fromVersion: "{{ old_version }}"
            toVersion: "{{ new_version }}"
            breakingChanges: "{{ yes|no }}"
            migrationGuide: "{{ guide_link }}"
            evidence: "{{ evidence_path }}"
        rollbackPlan: "{{ plan_description }}"
    
    governanceUpgrades:
      - governanceLayer: "{{ layer_name }}"
        changes:
          - policy: "{{ policy_name }}"
            change: "{{ added|modified|removed }}"
            complianceRequirement: "{{ mandatory|recommended|optional }}"
            enforcementLevel: "{{ strict|lenient }}"
            evidence: "{{ evidence_path }}"
        impact: "{{ low|medium|high }}"
    
    optimizationUpgrades:
      - area: "{{ optimization_area }}"
        technique: "{{ technique_used }}"
        beforeMetric: "{{ before_value }}"
        afterMetric: "{{ after_value }}"
        improvement: "{{ improvement_percentage }}%"
        tradeoffs:
          - tradeoff: "{{ description }}"
            impact: "{{ positive|negative|neutral }}"
        evidence: "{{ evidence_path }}"
    
    knowledgeBaseUpdates:
      - updateType: "{{ pattern|rule|lesson|best_practice }}"
        content: "{{ what_added }}"
        location: "{{ where_added }}"
        applicability: "{{ general|specific }}"
        confidence: "{{ confidence_score }}"
        evidence: "{{ evidence_path }}"

  upgradeReasoning:
    problemAnalysis:
      rootCause: "{{ identified_root_cause }}"
      contributingFactors:
        - factor: "{{ factor_name }}"
          weight: "{{ weight }}"
          evidence: "{{ evidence_path }}"
      impactAnalysis: "{{ business|technical|governance_impact }}"
      evidence: "{{ evidence_path }}"
    
    solutionDesign:
      consideredOptions:
        - option: "{{ option_name }}"
          pros: "{{ advantages }}"
          cons: "{{ disadvantages }}"
          feasibility: "{{ high|medium|low }}"
          evidence: "{{ evidence_path }}"
      selectedOption: "{{ option_name }}"
      selectionCriteria:
        - criterion: "{{ criterion }}"
          weight: "{{ weight }}"
          score: "{{ score }}"
          evidence: "{{ evidence_path }}"
    
    implementationStrategy:
      rolloutPlan: "{{ phased|big-bang }}"
      rollbackPlan: "{{ plan_description }}"
      riskMitigation: "{{ mitigation_strategy }}"
      evidence: "{{ evidence_path }}"

  impactAssessment:
    immediateImpacts:
      - system: "{{ system_component }}"
        impactType: "{{ performance|reliability|security }}"
        magnitude: "{{ low|medium|high }}"
        duration: "{{ temporary|permanent }}"
        evidence: "{{ evidence_path }}"
    
    processImpacts:
      - process: "{{ process_name }}"
        efficiencyChange: "{{ percentage }}%"
        reliabilityChange: "{{ percentage }}%"
        complexityChange: "{{ increased|decreased|unchanged }}"
        evidence: "{{ evidence_path }}"
    
    governanceImpacts:
      - compliance: "{{ compliance_area }}"
        before: "{{ previous_status }}"
        after: "{{ current_status }}"
        improvement: "{{ yes|no|neutral }}"
        evidence: "{{ evidence_path }}"
      - auditability: "{{ audit_trail_quality }}"
        change: "{{ improved|degraded|unchanged }}"
        evidence: "{{ evidence_path }}"
    
    knowledgeImpacts:
      - documentationUpdates: "{{ count }}"
        evidence: "{{ evidence_path }}"
      - trainingRequirements: "{{ new_requirements }}"
        evidence: "{{ evidence_path }}"
      - decisionLogUpdates: "{{ count }}"
        evidence: "{{ evidence_path }}"

  upgradeVerification:
    verificationTests:
      - test: "{{ test_name }}"
        status: "{{ passed|failed|skipped }}"
        evidence: "{{ test_results }}"
        executionTime: "{{ duration }}"
        evidence: "{{ evidence_path }}"
    
    regressionChecks:
      - check: "{{ check_name }}"
        area: "{{ functionality|performance|security }}"
        status: "{{ passed|failed }}"
        impact: "{{ low|medium|high }}"
        evidence: "{{ evidence_path }}"
    
    performanceValidation:
      benchmark: "{{ benchmark_name }}"
      before: "{{ previous_score }}"
      after: "{{ current_score }}"
      delta: "{{ change_percentage }}%"
      acceptable: "{{ yes|no }}"
      evidence: "{{ evidence_path }}"
    
    functionalValidation:
      - feature: "{{ feature_name }}"
        before: "{{ previous_behavior }}"
        after: "{{ current_behavior }}"
        status: "{{ working|broken|degraded }}"
        evidence: "{{ evidence_path }}"

  evolutionaryLearnings:
    discoveredPatterns:
      - pattern: "{{ pattern_name }}"
        context: "{{ where_found }}"
        applicability: "{{ general|specific }}"
        reusePotential: "{{ high|medium|low }}"
        confidence: "{{ confidence_score }}"
        evidence: "{{ evidence_path }}"
    
    adaptationMechanisms:
      - mechanism: "{{ mechanism_name }}"
        effectiveness: "{{ effectiveness_score }}"
        triggeredConditions: "{{ conditions }}"
        improvementSuggestions: "{{ suggestions }}"
        evidence: "{{ evidence_path }}"
    
    metaLearnings:
      - learning: "{{ about_the_upgrade_process }}"
        insight: "{{ deeper_understanding }}"
        application: "{{ how_to_apply }}"
        confidence: "{{ confidence_score }}"
        evidence: "{{ evidence_path }}"
    
    bestPractices:
      - practice: "{{ what_worked_well }}"
        context: "{{ when_applicable }}"
        evidence: "{{ evidence_path }}"
    
    lessonsLearned:
      - lesson: "{{ what_didnt_work }}"
        impact: "{{ how_it_affected }}"
        futureMitigation: "{{ how_to_avoid }}"
        evidence: "{{ evidence_path }}"

  upgradeMetadata:
    executedBy: "{{ agent_or_user }}"
    executionDuration: "{{ duration_seconds }}s"
    resourceConsumption:
      cpu: "{{ cpu_seconds }}"
      memory: "{{ memory_mb }}MB"
    
    dependencies:
      - component: "{{ component_name }}"
        version: "{{ version }}"
        role: "{{ how_used }}"
        evidence: "{{ evidence_path }}"
    
    artifactsGenerated:
      - artifact: "{{ artifact_name }}"
        location: "{{ path }}"
        purpose: "{{ why_created }}"
        evidence: "{{ evidence_path }}"
    
    references:
      - relatedExecution: "{{ execution_id }}"
        relationship: "{{ triggered_by|validated_by }}"
        evidence: "{{ evidence_path }}"
      - documentation: "{{ doc_link }}"
        type: "{{ design|api|user_guide }}"
        evidence: "{{ evidence_path }}"

  responsibilityMatrix:
    upgradeOwner: "{{ owner_name }}"
    approvers:
      - name: "{{ approver_name }}"
        role: "{{ role }}"
        approvalTimestamp: "{{ timestamp }}"
        evidence: "{{ evidence_path }}"
    reviewers:
      - name: "{{ reviewer_name }}"
        role: "{{ role }}"
        reviewTimestamp: "{{ timestamp }}"
        status: "{{ approved|rejected|pending }}"
        evidence: "{{ evidence_path }}"
    
    auditTrail:
      creationHash: "{{ sha256_hash }}"
      digitalSignature: "{{ signature }}"
      immutableLogReference: "{{ blockchain_or_immutable_storage_ref }}"
    
    compliance:
      policyCompliance: "{{ compliant|non-compliant }}"
      regulatoryRequirements: "{{ requirements_met }}"
      standardsAlignment: "{{ standards_followed }}"
      evidence: "{{ evidence_path }}"

  followUpActions:
    monitoringRequirements:
      - metric: "{{ metric_name }}"
        threshold: "{{ threshold_value }}"
        alertCondition: "{{ when_to_alert }}"
        owner: "{{ who_monitors }}"
        evidence: "{{ evidence_path }}"
    
    scheduledReviews:
      - reviewType: "{{ post-implementation-review }}"
        dueDate: "{{ date }}"
        participants: "{{ who_participates }}"
        objectives: "{{ review_goals }}"
        evidence: "{{ evidence_path }}"
    
    knowledgeDissemination:
      - audience: "{{ target_audience }}"
        format: "{{ documentation|training|announcement }}"
        deliveryDate: "{{ date }}"
        successCriteria: "{{ criteria }}"
        evidence: "{{ evidence_path }}"
    
    futureUpgrades:
      - upgradeType: "{{ planned_upgrade }}"
        triggerCondition: "{{ when_to_trigger }}"
        priority: "{{ p0|p1|p2|p3 }}"
        estimatedImpact: "{{ low|medium|high }}"
        evidence: "{{ evidence_path }}"

  postUpgradeMetrics:
    processMaturityIndex:
      before: "{{ score }}"
      after: "{{ score }}"
      delta: "{{ change }}"
      evidence: "{{ evidence_path }}"
    
    selfEvolutionRate:
      before: "{{ percentage }}%"
      after: "{{ percentage }}%"
      delta: "{{ change }}"
      evidence: "{{ evidence_path }}"
    
    learningAbsorptionRate:
      before: "{{ percentage }}%"
      after: "{{ percentage }}%"
      delta: "{{ change }}"
      evidence: "{{ evidence_path }}"
    
    knowledgeCompoundingFactor:
      before: "{{ factor }}"
      after: "{{ factor }}"
      delta: "{{ change }}"
      evidence: "{{ evidence_path }}"
    
    overallSuccess: "{{ yes|no }}"
    successCriteriaMet: "{{ count }}/{{ total }}"
    recommendation: "{{ approve|monitor|rollback }}"
    evidence: "{{ evidence_path }}"

  qualityGates:
    gate1:
      name: "verification_passed"
      threshold: "100%"
      actual: "{{ actual_value }}"
      status: "{{ passed|failed }}"
      evidence: "{{ evidence_path }}"
    gate2:
      name: "regression_free"
      threshold: "zero_regressions"
      actual: "{{ actual_value }}"
      status: "{{ passed|failed }}"
      evidence: "{{ evidence_path }}"
    gate3:
      name: "evidence_complete"
      threshold: 0.95
      actual: "{{ actual_value }}"
      status: "{{ passed|failed }}"
      evidence: "{{ evidence_path }}"
    
    overallStatus: "{{ passed|failed }}"
    canProceed: "{{ yes|no }}"