#
# @GL-governed
# @GL-layer: GL90-99
# @GL-semantic: governance
# @GL-audit-trail: ../../governance/GL_SEMANTIC_ANCHOR.json
#
apiVersion: gov-execution/v1
kind: ExecutionDeltaReport
metadata:
  comparisonId: "{{ auto_generated_uuid }}"
  baseExecution: "{{ previous_execution_id }}"
  targetExecution: "{{ current_execution_id }}"
  comparisonTimestamp: "{{ iso8601_timestamp }}"
  comparisonMethod: "semantic-diff-with-context"
  version: "1.0.0"

spec:
  comparisonConfig:
    scope:
      include:
        - executionMetadata
        - semanticAnalysis
        - governanceImpact
        - executionQuality
      exclude:
        - temporaryFiles
        - cacheData
    
    granularity: "semantic"
    similarityThreshold: 0.85
    significanceThreshold: 0.15

  executionLevelDelta:
    duration:
      base: "{{ previous_duration }}"
      target: "{{ current_duration }}"
      delta: "{{ change_percentage }}%"
      significance: "{{ low|medium|high }}"
      evidence: "{{ evidence_path }}"
    
    resourceUsage:
      cpu:
        base: "{{ previous_cpu }}"
        target: "{{ current_cpu }}"
        delta: "{{ change_percentage }}%"
        significance: "{{ low|medium|high }}"
      memory:
        base: "{{ previous_memory }}"
        target: "{{ current_memory }}"
        delta: "{{ change_percentage }}%"
        significance: "{{ low|medium|high }}"
    
    status:
      base: "{{ previous_status }}"
      target: "{{ current_status }}"
      changed: "{{ yes|no }}"
      improvement: "{{ yes|no|neutral }}"
      evidence: "{{ evidence_path }}"

  governanceDelta:
    contractCoverage:
      base:
        totalContracts: "{{ count }}"
        validated: "{{ count }}"
        coverage: "{{ percentage }}%"
      target:
        totalContracts: "{{ count }}"
        validated: "{{ count }}"
        coverage: "{{ percentage }}%"
      delta:
        newContracts: "{{ count }}"
        increasedCoverage: "{{ percentage_points }}%"
      evidence: "{{ evidence_path }}"
    
    validationRules:
      triggered:
        base: "{{ count }}"
        target: "{{ count }}"
        delta: "{{ count }}"
      successRate:
        base: "{{ percentage }}%"
        target: "{{ percentage }}%"
        delta: "{{ percentage_points }}%"
      newlyGenerated:
        count: "{{ count }}"
        examples:
          - rule: "{{ rule_name }}"
            context: "{{ when_generated }}"
            purpose: "{{ why_generated }}"
            evidence: "{{ evidence_path }}"
    
    complianceMetrics:
      metrics:
        - metric: "semverCompliance"
          base: "{{ percentage }}%"
          target: "{{ percentage }}%"
          delta: "{{ percentage_points }}%"
          trend: "{{ improving|declining|stable }}"
          significance: "{{ low|medium|high }}"
          evidence: "{{ evidence_path }}"
        - metric: "namingConventionCompliance"
          base: "{{ percentage }}%"
          target: "{{ percentage }}%"
          delta: "{{ percentage_points }}%"
          trend: "{{ improving|declining|stable }}"
          significance: "{{ low|medium|high }}"
          evidence: "{{ evidence_path }}"

  processStructureDelta:
    phaseChanges:
      - phase: "{{ phase_name }}"
        baseStructure:
          steps: "{{ count }}"
          sequence: "{{ sequence }}"
        targetStructure:
          steps: "{{ count }}"
          sequence: "{{ sequence }}"
        changes:
          addedSteps: "{{ step_names }}"
          removedSteps: "{{ step_names }}"
          reorderedSteps: "{{ yes|no }}"
        significance: "{{ low|medium|high }}"
        evidence: "{{ evidence_path }}"
    
    decisionPoints:
      - decision: "{{ decision_point }}"
        baseLogic: "{{ previous_logic }}"
        targetLogic: "{{ current_logic }}"
        changed: "{{ yes|no }}"
        reason: "{{ why_changed }}"
        impact: "{{ low|medium|high }}"
        evidence: "{{ evidence_path }}"
    
    fallbackMechanisms:
      - mechanism: "{{ mechanism_name }}"
        baseConfig: "{{ previous_config }}"
        targetConfig: "{{ current_config }}"
        improvement: "{{ yes|no }}"
        evidence: "{{ supporting_evidence }}"
        impact: "{{ low|medium|high }}"

  semanticReasoningDelta:
    inputInterpretation:
      base: "{{ previous_interpretation }}"
      target: "{{ current_interpretation }}"
      divergence: "{{ low|medium|high }}"
      accuracyChange: "{{ improved|declined|stable }}"
      evidence: "{{ evidence_path }}"
    
    reasoningPaths:
      - path: "{{ reasoning_path_id }}"
        base:
          steps: "{{ count }}"
          confidence: "{{ score }}"
          outcome: "{{ previous_outcome }}"
        target:
          steps: "{{ count }}"
          confidence: "{{ score }}"
          outcome: "{{ current_outcome }}"
        divergence:
          type: "{{ logical|factual|inferential }}"
          impact: "{{ low|medium|high }}"
          evidence: "{{ evidence_path }}"
    
    learningIntegration:
      previousLearningsApplied: "{{ count }}"
      newLearningsGenerated: "{{ count }}"
      learningEffectiveness: "{{ effectiveness_score }}"
      evidence: "{{ evidence_path }}"

  qualityPerformanceDelta:
    reliability:
      base: "{{ previous_score }}"
      target: "{{ current_score }}"
      delta: "{{ change }}"
      trend: "{{ improving|declining|stable }}"
      significance: "{{ low|medium|high }}"
      evidence: "{{ evidence_path }}"
    
    efficiency:
      base: "{{ previous_metric }}"
      target: "{{ current_metric }}"
      delta: "{{ change_percentage }}%"
      optimizationImpact: "{{ low|medium|high }}"
      evidence: "{{ evidence_path }}"
    
    bottlenecks:
      resolved:
        - bottleneck: "{{ description }}"
          resolution: "{{ how_resolved }}"
          impact: "{{ efficiency_gain }}%"
          evidence: "{{ evidence_path }}"
      introduced:
        - bottleneck: "{{ description }}"
          cause: "{{ likely_cause }}"
          severity: "{{ low|medium|high }}"
          evidence: "{{ evidence_path }}"
    
    anomalyDetection:
      baseAnomalies: "{{ count }}"
      targetAnomalies: "{{ count }}"
      newPatternsDetected: "{{ count }}"
      falsePositiveRateChange: "{{ percentage_points }}%"
      evidence: "{{ evidence_path }}"

  impactAnalysis:
    positiveImpacts:
      - impact: "{{ description }}"
        area: "{{ governance|efficiency|reliability }}"
        magnitude: "{{ low|medium|high }}"
        evidence: "{{ supporting_data }}"
    
    regressions:
      - regression: "{{ description }}"
        area: "{{ governance|efficiency|reliability }}"
        severity: "{{ low|medium|high }}"
        rootCause: "{{ likely_cause }}"
        mitigation: "{{ suggested_fix }}"
        evidence: "{{ evidence_path }}"
    
    recommendations:
      - priority: "p0"
        recommendation: "{{ what_to_do }}"
        reason: "{{ why }}"
        expectedBenefit: "{{ benefit }}"
        evidence: "{{ evidence_path }}"
      - priority: "p1"
        recommendation: "{{ what_to_do }}"
        reason: "{{ why }}"
        expectedBenefit: "{{ benefit }}"
        evidence: "{{ evidence_path }}"
    
    evolutionMetrics:
      processMaturityChange: "{{ maturity_score_delta }}"
      automationLevelChange: "{{ automation_score_delta }}"
      selfHealingCapabilityChange: "{{ self_healing_score_delta }}"
      evidence: "{{ evidence_path }}"

  changeClassification:
    aligned:
      - change: "{{ description }}"
        evidence: "{{ evidence_path }}"
    
    intentionalDeviation:
      - change: "{{ description }}"
        rationale: "{{ why_intentional }}"
        documented: "{{ yes|no }}"
        evidence: "{{ evidence_path }}"
    
    technicalDebt:
      - change: "{{ description }}"
        impact: "{{ low|medium|high }}"
        remediationPriority: "{{ p0|p1|p2|p3 }}"
        evidence: "{{ evidence_path }}"
    
    gap:
      - change: "{{ description }}"
        externalStandard: "{{ standard_name }}"
        missingInternally: "{{ yes|no }}"
        evidence: "{{ evidence_path }}"
    
    extension:
      - change: "{{ description }}"
        innovation: "{{ yes|no }}"
        potentialReuse: "{{ yes|no }}"
        evidence: "{{ evidence_path }}"

  significantChanges:
    thresholdMet: "{{ count }}"
    thresholdMissed: "{{ count }}"
    
    changes:
      - changeType: "{{ contract|rule|pipeline|governance }}"
        description: "{{ what_changed }}"
        impact: "{{ breaking|non-breaking|enhancement }}"
        severity: "{{ low|medium|high|critical }}"
        beforeState: "{{ previous_state }}"
        afterState: "{{ current_state }}"
        significanceScore: "{{ score }}"
        evidence: "{{ evidence_path }}"

  upgradeTriggers:
    triggered: "{{ yes|no }}"
    triggers:
      - trigger: "{{ ANALYSIS_FAILURE_PATTERN|DELTA_REGRESSION|DELTA_SIGNIFICANT_IMPROVEMENT|ANALYSIS_CRITICAL_OPPORTUNITY }}"
        condition: "{{ condition_met }}"
        severity: "{{ high|critical|medium }}"
        autoUpgrade: "{{ yes|no }}"
        evidence: "{{ evidence_path }}"
    
    recommendedUpgrades:
      - upgradeType: "{{ contract_upgrade|rule_upgrade|pipeline_upgrade|governance_upgrade }}"
        operation: "{{ add|modify|remove|create|update|deprecate|delete }}"
        priority: "{{ p0|p1|p2|p3 }}"
        estimatedImpact: "{{ low|medium|high }}"
        riskLevel: "{{ low|medium|high }}"
        evidence: "{{ evidence_path }}"

  verification:
    comparisonMethodology: "multi-dimensional-semantic-diff"
    confidence: "{{ confidence_score }}"
    
    validationChecks:
      - check: "data-integrity"
        status: "passed"
        evidence: "{{ checksum_validation }}"
      - check: "temporal-consistency"
        status: "passed"
        evidence: "{{ timeline_validation }}"
      - check: "evidence-coverage"
        status: "passed|failed"
        coverage: "{{ percentage }}%"
        evidence: "{{ evidence_path }}"
    
    auditTrail:
      generatedBy: "gl.execution.delta-engine"
      generationTimestamp: "{{ iso8601_timestamp }}"
      reviewedBy: "{{ reviewer }}"
      reviewTimestamp: "{{ review_timestamp }}"
      sourceDataHash: "{{ sha256_hash }}"

  qualityGates:
    gate1:
      name: "delta_significance"
      threshold: 0.15
      actual: "{{ actual_value }}"
      status: "{{ passed|failed }}"
    gate2:
      name: "regression_detection"
      threshold: "zero_tolerated"
      actual: "{{ actual_value }}"
      status: "{{ passed|failed }}"
    gate3:
      name: "evidence_coverage"
      threshold: 0.90
      actual: "{{ actual_value }}"
      status: "{{ passed|failed }}"
    
    overallStatus: "{{ passed|failed }}"
    canProceed: "{{ yes|no }}"