#
# @GL-governed
# @GL-layer: GL90-99
# @GL-semantic: governance
# @GL-audit-trail: ../../governance/GL_SEMANTIC_ANCHOR.json
#
apiVersion: governance.gl/v1
kind: GovernanceLayers
metadata:
  name: gov-governance-layers
  version: "1.0.0"
  description: "GL 治理層級定義 - 定義 8 個 GL 治理層級與職責邊界"
  category: governance
  compliance:
    - gov-enterprise-architecture
    - gov-boundary-enforcement
    - gov-meta-specifications

spec:
  governanceLayers:
    # GL00-09: 企業架構層
    - id: GL00-09
      name: "gov-enterprise-architecture"
      description: "企業架構層 - 定義企業級架構與治理框架"
      purpose: "企業治理框架"
      responsibilities:
        - "定義企業架構原則"
        - "建立治理框架"
        - "制定標準與規範"
      boundaries:
        - "純治理，無執行"
        - "提供契約給所有層級"
      dependencies: []
      allowedInteractions:
        - "向下提供治理契約"
        - "接受所有層級的合規報告"
    
    # GL10-29: 平台服務層
    - id: GL10-29
      name: "gov-platform-services"
      description: "平台服務層 - 平台服務與運營支持"
      purpose: "平台服務與運營"
      responsibilities:
        - "平台服務管理"
        - "運營支持"
        - "服務發現與協調"
      boundaries:
        - "平台服務與運營"
        - "服務發現與協調"
      dependencies:
        - "gov-enterprise-architecture"
      allowedInteractions:
        - "調用 GL00-09 的治理服務"
        - "向 GL20-29 提供平台服務"
    
    # GL20-29: 資料處理層
    - id: GL20-29
      name: "gov-data-processing"
      description: "資料處理層 - 資料管道與 ETL 處理"
      purpose: "資料處理工程"
      responsibilities:
        - "資料管道管理"
        - "ETL 處理"
        - "搜尋與索引"
      boundaries:
        - "資料處理邏輯"
        - "不包含業務邏輯"
      dependencies:
        - "gov-enterprise-architecture"
        - "gov-platform-services"
      allowedInteractions:
        - "調用 GL10-29 的平台服務"
        - "向 GL30-49 提供資料服務"
    
    # GL30-49: 執行運行時層
    - id: GL30-49
      name: "gov-execution-runtime"
      description: "執行運行時層 - 執行引擎與運行時"
      purpose: "任務執行與編排"
      responsibilities:
        - "任務執行"
        - "資源管理"
        - "編排與調度"
      boundaries:
        - "執行邏輯"
        - "不包含業務邏輯"
      dependencies:
        - "gov-enterprise-architecture"
        - "gov-platform-services"
        - "gov-data-processing"
      allowedInteractions:
        - "調用 GL10-29 和 GL20-29 的服務"
        - "提供執行能力給所有層級"
    
    # GL50-59: 可觀測性層
    - id: GL50-59
      name: "gov-observability"
      description: "可觀測性層 - 系統監控與可觀測性"
      purpose: "系統監控"
      responsibilities:
        - "監控與追蹤"
        - "日誌與分析"
        - "警報與通知"
      boundaries:
        - "只讀訪問所有層級"
        - "不影響執行邏輯"
      dependencies: []
      allowedInteractions:
        - "讀取所有層級的數據"
        - "向 GL60-80 提供監控數據"
    
    # GL60-80: 治理合規層
    - id: GL60-80
      name: "gov-governance-compliance"
      description: "治理合規層 - 治理執行與合規檢查"
      purpose: "治理執行與合規"
      responsibilities:
        - "策略執行"
        - "合規檢查"
        - "審計與報告"
      boundaries:
        - "只依賴 GL00-09（治理契約）"
        - "不執行任何邏輯"
      dependencies:
        - "gov-enterprise-architecture"
      allowedInteractions:
        - "從 GL00-09 獲取治理契約"
        - "檢查所有層級的合規性"
    
    # GL81-83: 擴展服務層
    - id: GL81-83
      name: "gov-extension-services"
      description: "擴展服務層 - 擴展服務與插件"
      purpose: "擴展機制"
      responsibilities:
        - "插件架構"
        - "擴展點管理"
        - "插件註冊與執行"
      boundaries:
        - "可擴展所有層級"
        - "不修改核心邏輯"
      dependencies:
        - "gov-enterprise-architecture"
      allowedInteractions:
        - "向所有層級提供擴展能力"
        - "管理所有擴展"
    
    # GL90-99: 元規範層
    - id: GL90-99
      name: "gov-meta-specifications"
      description: "元規範層 - 元規範定義"
      purpose: "元規範"
      responsibilities:
        - "元規範定義"
        - "規範註冊"
        - "規範版本管理"
      boundaries:
        - "純規範定義"
        - "參考-only"
      dependencies: []
      allowedInteractions:
        - "向所有層級提供規範定義"
        - "接受所有層級的規範請求"

  # 層級關係圖
  layerDependencies:
    GL00-09:
      dependsOn: []
      providesTo: ["GL10-29", "GL60-80", "GL81-83", "GL90-99"]
    
    GL10-29:
      dependsOn: ["GL00-09"]
      providesTo: ["GL20-29", "GL30-49"]
    
    GL20-29:
      dependsOn: ["GL00-09", "GL10-29"]
      providesTo: ["GL30-49"]
    
    GL30-49:
      dependsOn: ["GL00-09", "GL10-29", "GL20-29"]
      providesTo: ["all"]
    
    GL50-59:
      dependsOn: []
      providesTo: ["GL60-80"]
      allowedReadFrom: ["all"]
    
    GL60-80:
      dependsOn: ["GL00-09"]
      providesTo: ["all"]
      monitors: ["all"]
    
    GL81-83:
      dependsOn: ["GL00-09"]
      providesTo: ["all"]
      extends: ["all"]
    
    GL90-99:
      dependsOn: []
      providesTo: ["all"]
      defines: ["all"]

  # 邊界規則
  boundaryRules:
    - rule: "GL-GO-001"
      name: "層級邊界驗證"
      description: "層級必須遵守定義的邊界"
      level: "CRITICAL"
    
    - rule: "GL-GO-002"
      name: "依賴關係驗證"
      description: "層級間的依賴關係必須正確"
      level: "HIGH"
    
    - rule: "GL-GO-003"
      name: "互動規則驗證"
      description: "層級間的互動必須符合允許的互動"
      level: "CRITICAL"
    
    - rule: "GL-GO-004"
      name: "職責邊界驗證"
      description: "層級必須在職責邊界內運作"
      level: "HIGH"

  # 驗證規則
  validationRules:
    - id: GL-GO-001
      name: "層級邊界驗證"
      description: "層級必須遵守定義的邊界"
      level: "CRITICAL"
      check: "層級是否違反邊界規則"
      errorMessage: "層級違反邊界規則"
    
    - id: GL-GO-002
      name: "依賴關係驗證"
      description: "層級間的依賴關係必須正確"
      level: "HIGH"
      check: "依賴關係是否正確"
      errorMessage: "依賴關係不正確"
    
    - id: GL-GO-003
      name: "互動規則驗證"
      description: "層級間的互動必須符合允許的互動"
      level: "CRITICAL"
      check: "互動是否符合規則"
      errorMessage: "違反互動規則"
    
    - id: GL-GO-004
      name: "職責邊界驗證"
      description: "層級必須在職責邊界內運作"
      level: "HIGH"
      check: "是否超出職責邊界"
      errorMessage: "超出職責邊界"