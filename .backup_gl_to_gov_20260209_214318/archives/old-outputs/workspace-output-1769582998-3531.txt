#!/bin/bash
# GL Governance Post-Commit Hook - GL Unified Charter Activated
set -e

echo "GL Unified Charter Activated - Post-Commit Event Stream Generation"

# Generate governance event stream for this commit
COMMIT_HASH=$(git rev-parse HEAD)
COMMIT_AUTHOR=$(git log -1 --format='%an')
COMMIT_MESSAGE=$(git log -1 --format='%s')
TIMESTAMP=$(date -u +"%Y-%m-%dT%H:%M:%SZ")

# Write governance event
EVENT=$(cat <<EOF
{
  "event_id": "post-commit-${COMMIT_HASH}",
  "timestamp": "${TIMESTAMP}",
  "event_type": "COMMIT",
  "source": "post-commit-hook",
  "target": "repository",
  "action": "commit_completed",
  "status": "success",
  "details": {
    "commit_hash": "${COMMIT_HASH}",
    "author": "${COMMIT_AUTHOR}",
    "message": "${COMMIT_MESSAGE}"
  }
}
EOF
)

# Append to event stream
mkdir -p .governance
echo "$EVENT" >> .governance/event-stream.jsonl

echo "âœ… Governance event recorded for commit ${COMMIT_HASH}"