# @GL-layer: GQS-L4
# GL Proof Model v1.0.0 - Executable Contract
# @GL-governed
# @GL-layer: GL90-99
# @GL-semantic: proof-model

version: "1.0.0"
status: "PRODUCTION_READY"
component_type: "DataModel"

# 觸發條件
trigger:
  conditions:
    - type: "report_generation"
      scope: "all"
    - type: "evidence_collection"
      scope: "all"
    - type: "audit_request"
      scope: "all"

# 驗證規則
verify:
  # P0 FIX: Evidence Validation Rules (CRITICAL)
  evidence_validation:
    - rule: "evidence_must_exist"
      severity: "CRITICAL"
      check: "file.exists AND file.readable"
      error_message: "Evidence file does not exist or is not readable"
      remediation: "Verify evidence file path and permissions"
      
    - rule: "evidence_must_be_checksummed"
      severity: "CRITICAL"
      check: "file.checksum_valid AND file.checksum == SHA256"
      error_message: "Evidence missing or has invalid checksum"
      remediation: "Generate SHA-256 checksum for evidence file"
      
    - rule: "evidence_must_be_timestamped"
      severity: "HIGH"
      check: "evidence.timestamp valid AND evidence.timestamp <= current_time"
      error_message: "Evidence missing or has invalid timestamp"
      remediation: "Add ISO 8601 timestamp to evidence"
      
    - rule: "evidence_must_have_source"
      severity: "HIGH"
      check: "evidence.source exists AND evidence.source not_empty"
      error_message: "Evidence missing source attribution"
      remediation: "Document evidence source in evidence metadata"
      
    - rule: "evidence_chain_integrity"
      severity: "CRITICAL"
      check: "all_evidence_links_valid(proof_chain)"
      error_message: "Evidence chain has broken or invalid links"
      remediation: "Verify all evidence references in proof chain"
  proof_structure:
    - rule: "proof_must_have_id"
      severity: "CRITICAL"
      check: "proof.proof_id exists AND proof.proof_id format_valid"
      remediation: "Generate unique proof ID using UUID format"
    
    - rule: "proof_must_have_claim"
      severity: "CRITICAL"
      check: "proof.claim exists AND proof.claim not_empty"
      remediation: "Provide clear, testable claim"
    
    - rule: "proof_must_have_evidence"
      severity: "CRITICAL"
      check: "proof.evidence exists AND proof.evidence.length >= 1"
      remediation: "Link to verifiable evidence sources"
    
    - rule: "proof_must_have_verification"
      severity: "CRITICAL"
      check: "proof.verification exists AND proof.verification.status_valid"
      remediation: "Run verification and record results"

  evidence_types:
    - type: "source_file"
      required_fields: ["file_path", "line_range", "checksum", "timestamp"]
      validation:
        - "file_path must exist"
        - "checksum must be SHA-256"
        - "line_range must be valid"
    
    - type: "contract_reference"
      required_fields: ["contract_path", "section", "version"]
      validation:
        - "contract_path must be valid"
        - "section must exist in contract"
    
    - type: "validation_output"
      required_fields: ["validator_name", "exit_code", "output", "timestamp"]
      validation:
        - "exit_code must be integer"
        - "timestamp must be ISO 8601"
    
    - type: "reasoning_trace"
      required_fields: ["step_number", "action", "premise", "conclusion"]
      validation:
        - "step_number must be sequential"
        - "premise must reference evidence"

  proof_chains:
    - rule: "chain_must_be_complete"
      severity: "HIGH"
      check: "all_dependencies_satisfied(proof_chain)"
      remediation: "Resolve missing dependencies in proof chain"
    
    - rule: "no_circular_dependencies"
      severity: "CRITICAL"
      check: "not has_circular_references(proof_chain)"
      remediation: "Break circular references in proof chain"

# 審計規則
audit:
  governance_events:
    - event: "proof_created"
      required_fields: ["proof_id", "claim", "evidence_count"]
    
    - event: "proof_verified"
      required_fields: ["proof_id", "verification_status", "timestamp"]
    
    - event: "proof_chain_built"
      required_fields: ["chain_id", "proof_count", "integrity_check"]

  audit_trail:
    - requirement: "all_proofs_must_be_immutable"
      storage: "content_addressable"
      mechanism: "SHA-256 hash addressing"
    
    - requirement: "proof_chain_integrity"
      check: "cryptographic_signature_valid"
      algorithm: "RSA-2048"

# 異常處理策略
fallback:
  on_proof_creation_failure:
    action: "log_error_and_return_default"
    log_level: "ERROR"
    notify: ["governance_manager"]
  
  on_evidence_invalid:
    action: "reject_proof"
    generate_report: true
    suggest_remediation: true
  
  on_chain_verification_failure:
    action: "halt_processing"
    lock_chain: true
    notify: ["governance_manager", "security_team"]

# P0 FIX: Audit Rules
audit:
  - rule: "log_all_validations"
    scope: "all"
    retention: "90_days"
    storage: "sqlite"
    encryption: "AES-256"
    
  - rule: "log_evidence_validation_results"
    scope: "evidence_validation"
    include:
      - "validation_timestamp"
      - "evidence_path"
      - "checksum"
      - "validation_result"
      - "violations"
      - "remediation_actions"
      
  - rule: "log_proof_chain_validations"
    scope: "proof_chains"
    include:
      - "chain_id"
      - "validation_timestamp"
      - "chain_integrity_status"
      - "missing_dependencies"
      - "circular_references"

# 合約元數據
metadata:
  gl_semantic_layer: "GL90-99"
  gl_semantic_domain: "verification"
  gl_semantic_context: "governance"
  audit_trail_enabled: true
  created_at: "2026-02-02"
  updated_at: "2026-02-02"
  authors: ["GL-Governance-Team"]
  reviewers: ["GL-Cryptography-Team"]
  dependencies:
    - "ecosystem/contracts/verification/gov-verification-engine-spec.yaml"
  integration_points:
    - "EvidenceCollector.collect()"
    - "ProofBuilder.build()"
    - "ReportGenerator.generate()"